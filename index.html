<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JMAR - Gest√£o de Obras</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase (compat) - substitua firebaseConfig abaixo pelos seus valores -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script>
    // Firebase config fornecido pelo usu√°rio (adaptado para compat)
    const firebaseConfig = {
      apiKey: "AIzaSyDYoRK-wS2SBUDDRlRQMrGT6lNEIdGfR3c",
      authDomain: "basejmarteste.firebaseapp.com",
      databaseURL: "https://basejmarteste-default-rtdb.firebaseio.com",
      projectId: "basejmarteste",
      storageBucket: "basejmarteste.firebasestorage.app",
      messagingSenderId: "1014372056207",
      appId: "1:1014372056207:web:b6f75a442ca71a674204fa"
    };
    try {
      if (typeof firebaseConfig !== 'undefined' && firebaseConfig && firebaseConfig.storageBucket) {
        firebase.initializeApp(firebaseConfig);
        window.FIREBASE_ENABLED = true;
        console.log('‚úÖ Firebase inicializado');
      } else {
        window.FIREBASE_ENABLED = false;
        console.log('‚ö†Ô∏è Firebase n√£o configurado (firebaseConfig vazio). Usando localStorage.');
      }
    } catch (e) {
      window.FIREBASE_ENABLED = false;
      console.warn('‚ö†Ô∏è Erro ao inicializar Firebase:', e.message);
    }
  </script>
  <script src="./sdk/element_sdk.js"></script>
  <script src="./sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Montserrat', sans-serif;
    }
    .nav-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 2px solid transparent; }
    .nav-btn:hover { transform: translateY(-6px); border-color: rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); }
    .client-card { animation: slideUp 0.4s ease-out forwards; opacity: 0; transition: all 0.3s ease; }
    .client-card:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3); }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .action-btn { transition: all 0.2s ease; }
    .action-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3); }
    .back-btn { transition: all 0.2s ease; }
    .back-btn:hover { transform: translateX(-4px); background-color: rgba(255, 255, 255, 0.25) !important; }
    .video-modal { max-height: 80vh; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-slate-900 text-white overflow-auto">
  <div id="app" class="h-full w-full"><!-- Tela de Login -->
   <div id="login-screen" class="h-full w-full flex items-center justify-center p-4">
    <div class="w-full max-w-md">
     <div class="text-center mb-8">
      <div class="w-20 h-20 bg-gradient-to-br from-white to-slate-200 rounded-2xl flex items-center justify-center shadow-lg mx-auto mb-4">
       <svg viewbox="0 0 100 100" class="w-12 h-12"><rect x="15" y="50" width="20" height="35" fill="#1f2937" rx="2" /> <rect x="40" y="35" width="20" height="50" fill="#111827" rx="2" /> <rect x="65" y="20" width="20" height="65" fill="#0f172a" rx="2" /> <path d="M10 85 L90 85" stroke="#e5e7eb" stroke-width="4" stroke-linecap="round" />
       </svg>
      </div>
      <h1 class="text-4xl font-black text-white tracking-tight mb-2">JMAR</h1>
      <p class="text-slate-400 font-medium">Gest√£o de Obras</p>
     </div>
     <div class="bg-slate-800 rounded-2xl p-8 border border-slate-700 shadow-2xl">
      <form onsubmit="handleLogin(event)">
       <div class="mb-4"><label class="text-white font-semibold mb-2 block">Usu√°rio</label> <input type="text" id="login-username" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-blue-500 focus:outline-none" placeholder="Digite seu usu√°rio">
       </div>
       <div class="mb-6"><label class="text-white font-semibold mb-2 block">Senha</label> <input type="password" id="login-password" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-blue-500 focus:outline-none" placeholder="Digite sua senha">
       </div><button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-xl py-3 font-semibold transition-all"> Entrar </button>
      </form>
      <div class="mt-4 text-center">
       <p class="text-slate-400 text-sm">Primeira vez aqui? <button onclick="showRegisterMode()" class="text-blue-400 hover:text-blue-300 font-semibold">Cadastre-se</button></p>
      </div>
     </div>
    </div>
   </div><!-- Tela de Registro -->
   <div id="register-screen" class="h-full w-full flex items-center justify-center p-4 hidden">
    <div class="w-full max-w-md">
     <div class="text-center mb-8">
      <div class="w-20 h-20 bg-gradient-to-br from-white to-slate-200 rounded-2xl flex items-center justify-center shadow-lg mx-auto mb-4">
       <svg viewbox="0 0 100 100" class="w-12 h-12"><rect x="15" y="50" width="20" height="35" fill="#1f2937" rx="2" /> <rect x="40" y="35" width="20" height="50" fill="#111827" rx="2" /> <rect x="65" y="20" width="20" height="65" fill="#0f172a" rx="2" /> <path d="M10 85 L90 85" stroke="#e5e7eb" stroke-width="4" stroke-linecap="round" />
       </svg>
      </div>
      <h1 class="text-4xl font-black text-white tracking-tight mb-2">JMAR</h1>
      <p class="text-slate-400 font-medium">Criar Conta</p>
     </div>
     <div class="bg-slate-800 rounded-2xl p-8 border border-slate-700 shadow-2xl">
      <form onsubmit="handleRegister(event)">
       <div class="mb-4"><label class="text-white font-semibold mb-2 block">Usu√°rio</label> <input type="text" id="register-username" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-green-500 focus:outline-none" placeholder="Escolha um usu√°rio">
       </div>
       <div class="mb-4"><label class="text-white font-semibold mb-2 block">Senha</label> <input type="password" id="register-password" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-green-500 focus:outline-none" placeholder="Crie uma senha">
       </div>
       <div class="mb-6"><label class="text-white font-semibold mb-2 block">Confirmar Senha</label> <input type="password" id="register-password-confirm" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-green-500 focus:outline-none" placeholder="Confirme sua senha">
       </div><button type="submit" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-xl py-3 font-semibold transition-all"> Cadastrar </button>
      </form>
      <div class="mt-4 text-center">
       <p class="text-slate-400 text-sm">J√° tem conta? <button onclick="showLoginMode()" class="text-green-400 hover:text-green-300 font-semibold">Fa√ßa login</button></p>
      </div>
     </div>
    </div>
   </div><!-- Tela Inicial -->
   <div id="home-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-6 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-4">
       <div class="w-16 h-16 bg-gradient-to-br from-white to-slate-200 rounded-2xl flex items-center justify-center shadow-lg">
        <svg viewbox="0 0 100 100" class="w-12 h-12"><rect x="15" y="50" width="20" height="35" fill="#1f2937" rx="2" /> <rect x="40" y="35" width="20" height="50" fill="#111827" rx="2" /> <rect x="65" y="20" width="20" height="65" fill="#0f172a" rx="2" /> <path d="M10 85 L90 85" stroke="#e5e7eb" stroke-width="4" stroke-linecap="round" />
        </svg>
       </div>
       <div>
        <h1 id="company-title" class="text-4xl font-black text-white tracking-tight">JMAR</h1>
        <p id="welcome-subtitle" class="text-slate-400 font-medium text-sm">Gest√£o de Obras</p>
       </div>
      </div><button onclick="logout()" class="bg-red-600 hover:bg-red-500 rounded-xl px-4 py-2 font-semibold text-sm">Sair</button>
     </div>
    </header>
    <main class="flex-1 p-6 flex flex-col items-center justify-center gap-6">
     <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 w-full max-w-3xl"><button onclick="showScreen('obras-screen')" class="nav-btn bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-8 flex flex-col items-center gap-4 shadow-xl border-2 border-slate-700 hover:border-slate-500">
       <div class="w-20 h-20 bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl flex items-center justify-center shadow-lg">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
        </svg>
       </div><span class="text-xl font-bold text-white">Obras</span> </button> <button onclick="showScreen('avisos-screen')" class="nav-btn bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-8 flex flex-col items-center gap-4 shadow-xl border-2 border-slate-700 hover:border-slate-500">
       <div class="w-20 h-20 bg-gradient-to-br from-purple-600 to-purple-700 rounded-2xl flex items-center justify-center shadow-lg">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
       </div><span class="text-xl font-bold text-white">Avisos</span> </button>
     </div>
    </main>
    <footer class="bg-black border-t border-slate-800 p-4 text-center">
     <p class="text-slate-500 text-sm">¬© 2024 JMAR - Todos os direitos reservados</p>
    </footer>
   </div><!-- Tela de Obras -->
   <div id="obras-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('home-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Obras</h1>
       <p class="text-slate-500 text-sm">Gerenciamento de Clientes</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showAddClientModal()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Adicionar Novo Cliente</span> </button>
      <div id="clients-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de Avisos -->
   <div id="avisos-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('home-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Avisos</h1>
       <p class="text-slate-500 text-sm">Comunicados Importantes</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showAddNoticeModal()" class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Adicionar Novo Aviso</span> </button>
      <div id="notices-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de Detalhes do Cliente -->
   <div id="client-detail-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('obras-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 id="detail-client-name" class="text-2xl font-bold text-white">Cliente</h1>
       <p class="text-slate-500 text-sm">Documentos e M√≠dias</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-6 overflow-auto">
     <div class="max-w-4xl mx-auto">
      <div class="grid grid-cols-2 gap-4"><button onclick="showProjectsScreen()" class="action-btn bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
         </svg>
        </div><span class="font-bold text-white text-center">Projetos PDF</span> </button> <button onclick="showPhotosScreen()" class="action-btn bg-gradient-to-br from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
         </svg>
        </div><span class="font-bold text-white text-center">Fotos</span> </button> <button onclick="showVideosScreen()" class="action-btn bg-gradient-to-br from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
         </svg>
        </div><span class="font-bold text-white text-center">V√≠deos</span> </button> <button onclick="showOrdersScreen()" class="action-btn bg-gradient-to-br from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
         </svg>
        </div><span class="font-bold text-white text-center">Ordem de Servi√ßos</span> </button> <button onclick="showChecklistScreen()" class="action-btn bg-gradient-to-br from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white col-span-2">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg>
        </div><span class="font-bold text-white text-center">Checklist de Instala√ß√£o</span> </button>
      </div>
     </div>
    </main>
   </div><!-- Tela de Projetos -->
   <div id="projects-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Projetos PDF</h1>
       <p class="text-slate-500 text-sm">Gerenciar seus arquivos</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showUploadProjectModal()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Enviar Projeto PDF</span> </button>
      <div id="projects-container" class="space-y-3"></div>
     </div>
    </main>
   </div><!-- Tela de Fotos -->
   <div id="photos-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Fotos</h1>
       <p class="text-slate-500 text-sm">Galeria com descri√ß√µes</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showUploadPhotoModal()" class="w-full bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Enviar Foto</span> </button>
      <div id="photos-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de V√≠deos -->
   <div id="videos-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">V√≠deos</h1>
       <p class="text-slate-500 text-sm">Galeria de v√≠deos</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showUploadVideoModal()" class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Enviar V√≠deo</span> </button>
      <div id="videos-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de Ordem de Servi√ßos -->
   <div id="orders-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Ordem de Servi√ßos</h1>
       <p class="text-slate-500 text-sm">Controle de O.S.</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showAddOrderModal()" class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-500 hover:to-indigo-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Nova Ordem de Servi√ßo</span> </button>
      <div id="orders-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de Checklist -->
   <div id="checklist-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Checklist de Pe√ßas</h1>
       <p class="text-slate-500 text-sm">Controle de Instala√ß√£o</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showAddPieceModal()" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Adicionar Pe√ßa</span> </button>
      <div id="pieces-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Modais -->
   <div id="upload-project-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 class="text-xl font-bold text-white mb-4">Enviar Projeto PDF</h2>
     <form onsubmit="handleUploadProject(event)"><input type="file" id="project-file-input" accept=".pdf" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 file:bg-blue-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1">
      <div class="flex gap-3"><button type="button" onclick="hideUploadProjectModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-500 rounded-xl py-3 font-semibold">Enviar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="upload-photo-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700 max-h-96 overflow-auto">
     <h2 class="text-xl font-bold text-white mb-4">Enviar Foto</h2>
     <form onsubmit="handleUploadPhoto(event)"><input type="file" id="photo-file-input" accept="image/*" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 file:bg-slate-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1"> <input type="text" id="photo-title-input" placeholder="T√≠tulo da foto (ex: Porta 01 - Instala√ß√£o)" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" required> <input type="text" id="photo-responsible-input" placeholder="Seu nome (respons√°vel)" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" required> <textarea id="photo-description-input" required rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 resize-none" placeholder="Descri√ß√£o da foto..."></textarea>
      <div class="flex gap-3"><button type="button" onclick="hideUploadPhotoModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Enviar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="upload-video-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700 max-h-96 overflow-auto">
     <h2 class="text-xl font-bold text-white mb-4">Enviar V√≠deo</h2>
     <form onsubmit="handleUploadVideo(event)"><input type="file" id="video-file-input" accept="video/*" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 file:bg-red-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1"> <input type="text" id="video-name-input" placeholder="Nome do v√≠deo (ex: V√≠deo Instala√ß√£o - Porta 01)" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" required> <input type="text" id="video-responsible-input" placeholder="Seu nome (respons√°vel)" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" required> <textarea id="video-description-input" required rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 resize-none" placeholder="Descri√ß√£o do v√≠deo..."></textarea>
      <div class="flex gap-3"><button type="button" onclick="hideUploadVideoModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-red-600 hover:bg-red-500 rounded-xl py-3 font-semibold">Enviar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="add-order-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700 max-h-96 overflow-auto">
     <h2 class="text-xl font-bold text-white mb-4">Nova Ordem de Servi√ßo</h2>
     <form onsubmit="handleAddOrder(event)"><input type="text" id="os-title-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="T√≠tulo da O.S."> <input type="date" id="os-date-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4"> <input type="text" id="os-solicitante-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Solicitante"> <textarea id="os-description-input" required rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 resize-none" placeholder="Descri√ß√£o..."></textarea>
      <div class="mb-4"><label class="text-white font-semibold mb-2 block">V√≠deo Inicial (Opcional)</label> <input type="file" id="os-initial-video-input" accept="video/*" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white file:bg-slate-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1">
      </div>
      <div class="flex gap-3"><button type="button" onclick="hideAddOrderModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-500 rounded-xl py-3 font-semibold">Criar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="add-piece-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 class="text-xl font-bold text-white mb-4">Adicionar Pe√ßa</h2>
     <form onsubmit="handleAddPiece(event)"><select id="piece-type-select" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 focus:border-green-500"> <option value="">Selecione um tipo...</option> <option value="porta">Porta</option> <option value="janela">Janela</option> <option value="vidro">Vidro</option> <option value="outro">Outro</option> </select> <input type="text" id="piece-name-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Ex: Porta 01, Janela 05">
      <div class="flex gap-3"><button type="button" onclick="hideAddPieceModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-green-600 hover:bg-green-500 rounded-xl py-3 font-semibold">Adicionar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="task-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 id="task-modal-title" class="text-xl font-bold text-white mb-4">Completar Etapa</h2>
     <form onsubmit="handleCompleteTask(event)"><input type="text" id="task-person-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Nome de quem fez"> <input type="date" id="task-date-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4">
      <div class="flex gap-3"><button type="button" onclick="hideTaskModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-green-600 hover:bg-green-500 rounded-xl py-3 font-semibold">Confirmar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="add-client-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 class="text-xl font-bold text-white mb-4">Novo Cliente</h2>
     <form onsubmit="handleAddClient(event)"><input type="text" id="client-name-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Nome do cliente">
      <div class="flex gap-3"><button type="button" onclick="hideAddClientModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-emerald-600 hover:bg-emerald-500 rounded-xl py-3 font-semibold">Adicionar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="add-notice-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 class="text-xl font-bold text-white mb-4">Novo Aviso</h2>
     <form onsubmit="handleAddNotice(event)"><input type="text" id="notice-title-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="T√≠tulo"> <textarea id="notice-content-input" required rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 resize-none" placeholder="Conte√∫do..."></textarea>
      <div class="flex gap-3"><button type="button" onclick="hideAddNoticeModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-rose-600 hover:bg-rose-500 rounded-xl py-3 font-semibold">Adicionar</button>
      </div>
     </form>
    </div>
   </div><!-- Modal para Status da OS -->
   <div id="os-status-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700 max-h-96 overflow-auto">
     <h2 id="os-status-title" class="text-xl font-bold text-white mb-4">Atualizar Status</h2>
     <form onsubmit="handleOSStatusChange(event)"><input type="text" id="os-status-person" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Nome"> <input type="date" id="os-status-date" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4">
      <div id="os-number-container" class="mb-4 hidden"><label class="text-white font-semibold mb-2 block">N√∫mero da OS</label> <input type="text" id="os-number-input" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white" placeholder="Digite o n√∫mero">
      </div>
      <div id="os-status-video-container" class="mb-4 hidden"><label class="text-white font-semibold mb-2 block">V√≠deo</label> <input type="file" id="os-status-video" accept="video/*" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white file:bg-slate-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1">
      </div>
      <div class="flex gap-3"><button type="button" onclick="hideOSStatusModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-500 rounded-xl py-3 font-semibold">Confirmar</button>
      </div>
     </form>
    </div>
   </div><!-- Modal de Visualiza√ß√£o de V√≠deo -->
   <div id="video-player-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-2xl shadow-2xl border border-slate-700">
     <div class="flex items-center justify-between mb-4">
      <h2 id="video-player-title" class="text-xl font-bold text-white">V√≠deo</h2><button onclick="hideVideoPlayerModal()" class="text-slate-400 hover:text-white">√ó</button>
     </div>
     <video id="video-player" controls class="w-full rounded-lg bg-black"></video>
    </div>
   </div><!-- Modal de Visualiza√ß√£o de Foto -->
   <div id="photo-viewer-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-3xl shadow-2xl border border-slate-700">
     <div class="flex items-center justify-between mb-4">
      <h2 id="photo-viewer-title" class="text-xl font-bold text-white">Foto</h2><button onclick="hidePhotoViewerModal()" class="text-slate-400 hover:text-white text-2xl">√ó</button>
     </div>
     <div class="bg-black rounded-lg overflow-hidden"><img id="photo-viewer-image" src="" alt="Foto" class="w-full h-auto max-h-96 object-contain">
     </div>
     <p id="photo-viewer-description" class="text-white mt-4 text-sm"></p>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = { company_name: 'JMAR', welcome_text: 'Gest√£o de Obras' };
    let config = { ...defaultConfig };
    let allData = [];
    let currentRecordCount = 0;
    let currentClientForChecklist = null;
    let currentUser = null;
    let users = JSON.parse(localStorage.getItem('jmar_users')) || {};
    let currentTaskData = { pieceId: null, taskField: null };
    let currentOSStatusData = { orderId: null, statusField: null };

    function showLoginMode() {
      document.getElementById('register-screen').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
    }

    function showRegisterMode() {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('register-screen').classList.remove('hidden');
    }

    function handleLogin(event) {
      event.preventDefault();
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value.trim();

      if (users[username] && users[username] === password) {
        currentUser = username;
        document.getElementById('login-screen').classList.add('hidden');
        showScreen('home-screen');
        showToast(`Bem-vindo, ${username}!`);
      } else {
        showToast('Usu√°rio ou senha incorretos!', 'error');
      }
    }

    function handleRegister(event) {
      event.preventDefault();
      const username = document.getElementById('register-username').value.trim();
      const password = document.getElementById('register-password').value.trim();
      const confirm = document.getElementById('register-password-confirm').value.trim();

      if (username.length < 3) {
        showToast('Usu√°rio deve ter pelo menos 3 caracteres!', 'error');
        return;
      }
      if (password.length < 4) {
        showToast('Senha deve ter pelo menos 4 caracteres!', 'error');
        return;
      }
      if (password !== confirm) {
        showToast('Senhas n√£o coincidem!', 'error');
        return;
      }
      if (users[username]) {
        showToast('Usu√°rio j√° existe!', 'error');
        return;
      }

      users[username] = password;
      localStorage.setItem('jmar_users', JSON.stringify(users));
      showToast('Conta criada com sucesso!');
      showLoginMode();
      document.getElementById('register-username').value = '';
      document.getElementById('register-password').value = '';
      document.getElementById('register-password-confirm').value = '';
    }

    function logout() {
      currentUser = null;
      document.getElementById('login-screen').classList.remove('hidden');
      showScreen('login-screen');
      document.getElementById('login-username').value = '';
      document.getElementById('login-password').value = '';
    }

    function showScreen(screenId) {
      console.log('üé¨ Mudando para tela:', screenId);
      ['home-screen', 'obras-screen', 'avisos-screen', 'client-detail-screen', 'checklist-screen', 'projects-screen', 'photos-screen', 'videos-screen', 'orders-screen'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(screenId).classList.remove('hidden');
      
      // Sempre carrega dados do localStorage quando muda de tela
      if (window.dataSdk && window.dataSdk.storage) {
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
        console.log('üìä Dados carregados para tela:', allData.length, 'registros');
      } else {
        console.warn('‚ö†Ô∏è dataSdk n√£o dispon√≠vel ou storage vazio');
      }
      
      // Renderiza clientes e avisos quando a tela de obras √© exibida
      if (screenId === 'obras-screen') {
        console.log('üë∑ Renderizando clientes e avisos...');
        renderClients(allData);
        renderNotices(allData);
      }
    }

    function showClientDetail(clientName) {
      document.getElementById('detail-client-name').textContent = clientName;
      showScreen('client-detail-screen');
    }

    function showChecklistScreen() {
      currentClientForChecklist = document.getElementById('detail-client-name').textContent;
      showScreen('checklist-screen');
      renderPieces();
    }

    function showProjectsScreen() { showScreen('projects-screen'); renderProjects(); }
    function showPhotosScreen() { showScreen('photos-screen'); renderPhotos(); }
    function showVideosScreen() { showScreen('videos-screen'); renderVideos(); }
    function showOrdersScreen() { showScreen('orders-screen'); renderOrders(); }

    function showAddClientModal() { document.getElementById('add-client-modal').classList.remove('hidden'); }
    function hideAddClientModal() { document.getElementById('add-client-modal').classList.add('hidden'); }
    function showAddNoticeModal() { document.getElementById('add-notice-modal').classList.remove('hidden'); }
    function hideAddNoticeModal() { document.getElementById('add-notice-modal').classList.add('hidden'); }
    function showAddPieceModal() { document.getElementById('add-piece-modal').classList.remove('hidden'); }
    function hideAddPieceModal() { document.getElementById('add-piece-modal').classList.add('hidden'); }
    function showUploadProjectModal() { document.getElementById('upload-project-modal').classList.remove('hidden'); }
    function hideUploadProjectModal() { document.getElementById('upload-project-modal').classList.add('hidden'); }
    function showUploadPhotoModal() { document.getElementById('upload-photo-modal').classList.remove('hidden'); }
    function hideUploadPhotoModal() { document.getElementById('upload-photo-modal').classList.add('hidden'); }
    function showUploadVideoModal() { document.getElementById('upload-video-modal').classList.remove('hidden'); }
    function hideUploadVideoModal() { document.getElementById('upload-video-modal').classList.add('hidden'); }
    function showAddOrderModal() { document.getElementById('add-order-modal').classList.remove('hidden'); }
    function hideAddOrderModal() { document.getElementById('add-order-modal').classList.add('hidden'); }

    function showTaskModal(pieceId, taskField, taskName) {
      currentTaskData = { pieceId, taskField };
      document.getElementById('task-modal-title').textContent = `Completar: ${taskName}`;
      document.getElementById('task-person-input').value = '';
      document.getElementById('task-date-input').value = new Date().toISOString().split('T')[0];
      document.getElementById('task-modal').classList.remove('hidden');
    }

    function hideTaskModal() { document.getElementById('task-modal').classList.add('hidden'); }

    function showOSStatusModal(orderId, statusField, statusName) {
      currentOSStatusData = { orderId, statusField };
      document.getElementById('os-status-title').textContent = statusName;
      document.getElementById('os-status-person').value = '';
      document.getElementById('os-status-date').value = new Date().toISOString().split('T')[0];
      document.getElementById('os-status-video').value = '';
      document.getElementById('os-number-input').value = '';
      
      // Mostrar input de n√∫mero apenas para Arquivado
      const numberContainer = document.getElementById('os-number-container');
      if (statusField === 'os_archived') {
        numberContainer.classList.remove('hidden');
      } else {
        numberContainer.classList.add('hidden');
      }
      
      // Mostrar input de v√≠deo para Obra Finalizada
      const videoContainer = document.getElementById('os-status-video-container');
      if (statusField === 'os_finalized') {
        videoContainer.classList.remove('hidden');
      } else {
        videoContainer.classList.add('hidden');
      }
      
      document.getElementById('os-status-modal').classList.remove('hidden');
    }

    function hideOSStatusModal() { document.getElementById('os-status-modal').classList.add('hidden'); }

    function showVideoPlayerModal(videoData, videoName) {
      let videoSrc = videoData;
      
      // Se for uma chave do localStorage, recupera o arquivo
      if (videoData && !videoData.startsWith('data:') && !videoData.startsWith('blob:')) {
        const fromStorage = localStorage.getItem(videoData);
        if (fromStorage) {
          videoSrc = fromStorage;
        }
      }
      
      document.getElementById('video-player-title').textContent = videoName || 'V√≠deo';
      document.getElementById('video-player').src = videoSrc;
      document.getElementById('video-player-modal').classList.remove('hidden');
    }

    function hideVideoPlayerModal() { document.getElementById('video-player-modal').classList.add('hidden'); }

    function showPhotoViewerModal(photoData, photoDescription, photoTitle = '', photoResponsible = '') {
      document.getElementById('photo-viewer-image').src = photoData;
      document.getElementById('photo-viewer-title').textContent = photoTitle || 'Foto';
      document.getElementById('photo-viewer-description').innerHTML = `${photoDescription}${photoResponsible ? `<p class="text-blue-400 text-xs mt-2">Por: ${photoResponsible}</p>` : ''}`;
      document.getElementById('photo-viewer-modal').classList.remove('hidden');
    }

    function hidePhotoViewerModal() { document.getElementById('photo-viewer-modal').classList.add('hidden'); }

    async function handleCompleteTask(event) {
      event.preventDefault();
      const person = document.getElementById('task-person-input').value.trim();
      const date = document.getElementById('task-date-input').value;
      const { pieceId, taskField } = currentTaskData;

      const piece = allData.find(p => p.__backendId === pieceId);
      if (piece) {
        const updatedPiece = {
          ...piece,
          [taskField]: true,
          [`${taskField}_by`]: person,
          [`${taskField}_date`]: date
        };
        const result = await window.dataSdk.update(updatedPiece);
        if (result.isOk) {
          hideTaskModal();
          showToast(`Etapa "${taskField}" conclu√≠da por ${person}!`);
          renderPieces();
        } else {
          showToast('Erro ao atualizar pe√ßa.', 'error');
        }
      }
    }

    async function handleOSStatusChange(event) {
      event.preventDefault();
      const person = document.getElementById('os-status-person').value.trim();
      const date = document.getElementById('os-status-date').value;
      const videoFile = document.getElementById('os-status-video').files[0];
      const osNumber = document.getElementById('os-number-input').value.trim();
      const { orderId, statusField } = currentOSStatusData;

      const order = allData.find(o => o.__backendId === orderId);
      if (order) {
        const updates = {
          ...order,
          [statusField]: true,
          [`${statusField}_by`]: person,
          [`${statusField}_date`]: date
        };

        // Se for arquivado, salva o n√∫mero
        if (statusField === 'os_archived' && osNumber) {
          updates.os_number = osNumber;
        }

        // Processa v√≠deo apenas para Obra Finalizada
        if (statusField === 'os_finalized' && videoFile) {
          const reader = new FileReader();
          reader.onload = async (e) => {
            updates.os_finalized_video = e.target.result;
            updates.os_finalized_video_name = videoFile.name;
            
            // Adiciona informa√ß√£o do v√≠deo na lista
            const videosArray = order.os_all_videos ? JSON.parse(order.os_all_videos) : [];
            videosArray.push({
              video_data: e.target.result,
              video_name: videoFile.name,
              uploaded_by: person,
              uploaded_date: date
            });
            updates.os_all_videos = JSON.stringify(videosArray);
            
            const result = await window.dataSdk.update(updates);
            if (result.isOk) {
              hideOSStatusModal();
              showToast('Status atualizado com sucesso!');
              renderOrders();
            } else {
              showToast('Erro ao atualizar.', 'error');
            }
          };
          reader.readAsDataURL(videoFile);
        } else {
          const result = await window.dataSdk.update(updates);
          if (result.isOk) {
            hideOSStatusModal();
            showToast('Status atualizado com sucesso!');
            renderOrders();
          } else {
            showToast('Erro ao atualizar.', 'error');
          }
        }
      }
    }

    function renderClients(data) {
      const container = document.getElementById('clients-container');
      const clients = data.filter(item => item.type === 'client');
      
      if (clients.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhum cliente cadastrado</p></div>';
        return;
      }

      container.innerHTML = clients.map((client, index) => `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.1}s">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center text-white font-bold">${client.client_name.charAt(0)}</div>
              <div><h3 class="font-bold text-white text-lg">${client.client_name}</h3><p class="text-slate-500 text-sm">${new Date(client.created_at).toLocaleDateString('pt-BR')}</p></div>
            </div>
            <button onclick="deleteClient('${client.id || client.__backendId}')" class="w-8 h-8 bg-red-500/20 hover:bg-red-500/40 rounded-lg flex items-center justify-center">
              <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            </button>
          </div>
          <div class="grid grid-cols-4 gap-2">
            <button onclick="showClientDetail('${client.client_name}')" class="bg-blue-600 hover:bg-blue-500 rounded-lg py-2 px-3 text-xs font-medium">Projetos</button>
            <button onclick="showClientDetail('${client.client_name}')" class="bg-slate-700 hover:bg-slate-600 rounded-lg py-2 px-3 text-xs font-medium">Fotos</button>
            <button onclick="showClientDetail('${client.client_name}')" class="bg-slate-700 hover:bg-slate-600 rounded-lg py-2 px-3 text-xs font-medium">V√≠deos</button>
            <button onclick="showClientDetail('${client.client_name}')" class="bg-slate-700 hover:bg-slate-600 rounded-lg py-2 px-3 text-xs font-medium">O.S.</button>
          </div>
        </div>
      `).join('');
    }

    function renderNotices(data) {
      const container = document.getElementById('notices-container');
      const notices = data.filter(item => item.type === 'notice');
      
      if (notices.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhum aviso cadastrado</p></div>';
        return;
      }

      container.innerHTML = notices.map((notice, index) => `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.1}s">
          <div class="flex items-start justify-between gap-4">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-gradient-to-br from-rose-400 to-pink-500 rounded-xl flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg></div>
                <div><h3 class="font-bold text-white">${notice.title}</h3><p class="text-slate-400 text-xs">${new Date(notice.created_at).toLocaleDateString('pt-BR')}</p></div>
              </div>
              <p class="text-slate-300 text-sm">${notice.content}</p>
            </div>
            <button onclick="deleteNotice('${notice.__backendId}')" class="w-8 h-8 bg-red-500/20 hover:bg-red-500/40 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
          </div>
        </div>
      `).join('');
    }

    function renderPieces() {
      const container = document.getElementById('pieces-container');
      const pieces = allData.filter(item => item.type === 'piece' && item.client_id === currentClientForChecklist);
      
      if (pieces.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhuma pe√ßa adicionada</p></div>';
        return;
      }

      container.innerHTML = pieces.map((piece, index) => {
        const isCompleted = piece.caixilho && piece.vidro && piece.regulagem && piece.vedacao && piece.arremate;
        const completedTasks = [piece.caixilho, piece.vidro, piece.regulagem, piece.vedacao, piece.arremate].filter(Boolean).length;
        const totalTasks = 5;

        const tasks = [
          { field: 'caixilho', label: '1. Caixilho', by: piece.caixilho_by, date: piece.caixilho_date, completed: piece.caixilho },
          { field: 'vidro', label: '2. Vidro', by: piece.vidro_by, date: piece.vidro_date, completed: piece.vidro },
          { field: 'regulagem', label: '3. Regulagem', by: piece.regulagem_by, date: piece.regulagem_date, completed: piece.regulagem },
          { field: 'vedacao', label: '4. Veda√ß√£o', by: piece.vedacao_by, date: piece.vedacao_date, completed: piece.vedacao },
          { field: 'arremate', label: '5. Arremate', by: piece.arremate_by, date: piece.arremate_date, completed: piece.arremate }
        ];

        return `
          <div class="client-card bg-slate-800 rounded-2xl p-5 border-2 ${isCompleted ? 'border-green-500 bg-green-900/20' : 'border-orange-500 bg-orange-900/10'} shadow-lg" style="animation-delay: ${index * 0.05}s">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-gradient-to-br ${isCompleted ? 'from-green-400 to-green-600' : 'from-orange-400 to-orange-600'} rounded-xl flex items-center justify-center text-white font-bold">${isCompleted ? '‚úì' : totalTasks - completedTasks}</div>
                <div><h3 class="font-bold text-white text-lg capitalize">${piece.piece_type} - ${piece.piece_name}</h3><p class="text-slate-500 text-sm">${completedTasks}/${totalTasks} etapas</p></div>
              </div>
              <button onclick="deletePiece('${piece.__backendId}')" class="w-8 h-8 bg-red-500/20 hover:bg-red-500/40 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
            </div>
            <div class="mb-4"><div class="w-full bg-slate-700 rounded-full h-2 overflow-hidden"><div class="bg-gradient-to-r from-orange-500 to-green-500 h-full rounded-full" style="width: ${(completedTasks / totalTasks) * 100}%"></div></div></div>
            <div class="grid grid-cols-1 gap-2">
              ${tasks.map(task => `
                <div class="${task.completed ? 'bg-green-900/30 border border-green-600' : 'hover:bg-slate-700/50'} rounded-lg p-3 transition-all">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                      <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="showTaskModal('${piece.__backendId}', '${task.field}', '${task.label}')" class="w-5 h-5 rounded cursor-pointer">
                      <span class="text-white font-medium">${task.label}</span>
                    </div>
                    ${task.completed ? '<span class="text-xs bg-green-600 text-white px-2 py-1 rounded">‚úì</span>' : ''}
                  </div>
                  ${task.completed ? `<p class="text-slate-400 text-xs ml-8">Realizado por <strong>${task.by}</strong> em ${new Date(task.date).toLocaleDateString('pt-BR')}</p>` : ''}
                </div>
              `).join('')}
            </div>
            ${isCompleted ? '<div class="mt-4 p-3 bg-green-600/30 border border-green-500 rounded-lg text-green-300 font-bold">Pe√ßa Finalizada! ‚úì</div>' : '<div class="mt-4 p-3 bg-orange-600/30 border border-orange-500 rounded-lg text-orange-300 font-bold">Pendente - ' + (totalTasks - completedTasks) + ' etapa' + (totalTasks - completedTasks !== 1 ? 's' : '') + '</div>'}
          </div>
        `;
      }).join('');
    }

    function renderProjects() {
      const container = document.getElementById('projects-container');
      const clientName = document.getElementById('detail-client-name').textContent;
      const projects = allData.filter(item => item.type === 'project' && item.client_id === clientName);
      
      if (projects.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhum projeto enviado</p></div>';
        return;
      }

      container.innerHTML = projects.map((proj, index) => `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.05}s">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-gradient-to-br from-red-400 to-red-600 rounded-xl flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg></div>
              <div><h3 class="font-bold text-white">${proj.file_name}</h3><p class="text-slate-500 text-sm">${new Date(proj.created_at).toLocaleDateString('pt-BR')}</p></div>
            </div>
            <button onclick="downloadProject('${proj.__backendId}')" class="w-10 h-10 bg-blue-600 hover:bg-blue-500 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg></button>
          </div>
        </div>
      `).join('');
    }

    function renderPhotos() {
      const container = document.getElementById('photos-container');
      const clientName = document.getElementById('detail-client-name').textContent;
      const photos = allData.filter(item => item.type === 'photo' && item.client_id === clientName);
      
      if (photos.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhuma foto enviada</p></div>';
        return;
      }

      container.innerHTML = photos.map((photo, index) => {
        const photoData = localStorage.getItem(photo.file_data) || photo.file_data;
        const photoTitle = photo.photo_title || 'Foto sem t√≠tulo';
        return `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.05}s">
          <div class="flex items-start gap-4">
            <div class="w-24 h-24 bg-slate-700 rounded-lg overflow-hidden flex-shrink-0 cursor-pointer hover:opacity-80 transition-opacity" onclick="showPhotoViewerModal('${photoData}', '${photo.photo_description}', '${photoTitle}', '${photo.photo_responsible}')">
              <img src="${photoData}" alt="Foto" class="w-full h-full object-cover" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 fill=%22%23666%22 viewBox=%220 0 24 24%22%3E%3Cpath d=%22M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z/%3E%3C/svg%3E'">
            </div>
            <div class="flex-1">
              <h3 class="font-bold text-white text-sm">${photoTitle}</h3>
              <p class="text-slate-500 text-xs">Por: <span class="text-blue-400">${photo.photo_responsible || 'N√£o informado'}</span></p>
              <p class="text-slate-400 text-xs mt-1">${new Date(photo.created_at).toLocaleDateString('pt-BR')}</p>
              <p class="text-white mt-2 text-xs">${photo.photo_description}</p>
              <div class="flex gap-2 mt-3">
                <button onclick="showPhotoViewerModal('${photoData}', '${photo.photo_description}', '${photoTitle}', '${photo.photo_responsible}')" class="text-blue-400 hover:text-blue-300 text-sm font-medium">üëÅÔ∏è Ver Foto</button>
                <button onclick="deletePhoto('${photo.__backendId}')" class="text-red-400 hover:text-red-300 text-sm font-medium">üóëÔ∏è Excluir</button>
              </div>
            </div>
          </div>
        </div>
      `}).join('');
    }

    function renderVideos() {
      const container = document.getElementById('videos-container');
      const clientName = document.getElementById('detail-client-name').textContent;
      const videos = allData.filter(item => item.type === 'video' && item.client_id === clientName);
      
      if (videos.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhum v√≠deo enviado</p></div>';
        return;
      }

      container.innerHTML = videos.map((video, index) => {
        const videoData = localStorage.getItem(video.file_data) || video.file_data;
        const videoTitle = video.video_name || video.file_name || 'V√≠deo';
        return `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.05}s">
          <div class="flex items-start gap-4">
            <div class="w-24 h-24 bg-slate-700 rounded-lg overflow-hidden flex-shrink-0 flex items-center justify-center">
              <svg class="w-12 h-12 text-red-400" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </div>
            <div class="flex-1">
              <h3 class="font-bold text-white text-sm">${videoTitle}</h3>
              <p class="text-slate-500 text-xs">Por: <span class="text-blue-400">${video.video_responsible || 'N√£o informado'}</span></p>
              <p class="text-slate-400 text-xs mt-1">${new Date(video.created_at).toLocaleDateString('pt-BR')}</p>
              <p class="text-white mt-2 text-xs">${video.video_description}</p>
              <div class="flex gap-2 mt-3">
                <button onclick="showVideoPlayerModal('${videoData}', '${videoTitle}')" class="text-blue-400 hover:text-blue-300 text-sm font-medium">‚ñ∂ Assistir</button>
                <button onclick="deleteVideo('${video.__backendId}')" class="text-red-400 hover:text-red-300 text-sm font-medium">Excluir</button>
              </div>
            </div>
          </div>
        </div>
      `}).join('');
    }

    function renderOrders() {
      const container = document.getElementById('orders-container');
      const clientName = document.getElementById('detail-client-name').textContent;
      const orders = allData.filter(item => item.type === 'order' && item.client_id === clientName);
      
      if (orders.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhuma ordem de servi√ßo criada</p></div>';
        return;
      }

      container.innerHTML = orders.map((order, index) => {
        const allStatusCompleted = order.os_archived && order.os_produced && order.os_material_separated && order.os_finalized;
        const videosArray = order.os_all_videos ? JSON.parse(order.os_all_videos) : [];
        
        const statusArray = [
          { name: '1Ô∏èÔøΩÔøΩÔøΩ Arquivado', completed: order.os_archived, field: 'os_archived', by: order.os_archived_by, date: order.os_archived_date, hasVideo: false, number: order.os_number || '' },
          { name: '2Ô∏è‚É£ Produzido', completed: order.os_produced, field: 'os_produced', by: order.os_produced_by, date: order.os_produced_date, hasVideo: false },
          { name: '3Ô∏è‚É£ Material Separado', completed: order.os_material_separated, field: 'os_material_separated', by: order.os_material_by, date: order.os_material_date, hasVideo: false },
          { name: '4Ô∏è‚É£ Obra Finalizada', completed: order.os_finalized, field: 'os_finalized', by: order.os_finalized_by, date: order.os_finalized_date, hasVideo: !!order.os_finalized_video }
        ];

        return `
          <div class="client-card bg-slate-800 rounded-2xl p-5 border-2 ${allStatusCompleted ? 'border-green-500 bg-green-900/10' : 'border-indigo-500'} shadow-lg" style="animation-delay: ${index * 0.05}s">
            <div class="flex items-start justify-between mb-3">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h3 class="font-bold text-white text-lg">${order.os_title}</h3>
                  <span class="${allStatusCompleted ? 'bg-green-600' : 'bg-indigo-600'} text-white text-xs px-3 py-1 rounded-full">${allStatusCompleted ? '‚úì Conclu√≠do' : 'Em Progresso'}</span>
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm mb-3">
                  <div><p class="text-slate-400">Data:</p><p class="text-white font-medium">${order.os_date}</p></div>
                  <div><p class="text-slate-400">Solicitante:</p><p class="text-white font-medium">${order.os_solicitante}</p></div>
                </div>
                <div class="mb-3">
                  <p class="text-slate-400 text-sm">Descri√ß√£o:</p>
                  <p class="text-white mt-1 text-sm">${order.os_description}</p>
                </div>
                ${order.os_initial_video ? `
                  <div class="bg-blue-900/30 border border-blue-600 rounded-lg p-2 mb-3">
                    <button onclick="showVideoPlayerModal('${order.os_initial_video}', 'V√≠deo Inicial da O.S.')" class="text-blue-400 hover:text-blue-300 text-sm font-medium flex items-center gap-2">
                      ‚ñ∂ Ver V√≠deo Inicial
                    </button>
                  </div>
                ` : ''}
                <div class="bg-slate-900/50 rounded-lg p-3 mb-3 border border-slate-700">
                  <p class="text-white font-semibold mb-2 text-sm">Status da Execu√ß√£o:</p>
                  <div class="space-y-2">
                    ${statusArray.map(status => `
                      <div class="flex items-center justify-between p-2 rounded ${status.completed ? 'bg-green-900/30 border border-green-600' : 'hover:bg-slate-700/50'}">
                        <div class="flex items-center gap-2">
                          <input type="checkbox" ${status.completed ? 'checked' : ''} onchange="showOSStatusModal('${order.__backendId}', '${status.field}', '${status.name}')" class="w-4 h-4 rounded cursor-pointer">
                          <span class="text-white text-sm">${status.name}</span>
                          ${status.completed ? '<span class="text-xs bg-green-600 text-white px-2 py-1 rounded">‚úì</span>' : ''}
                        </div>
                        ${status.completed ? `
                          <div class="text-right">
                            <p class="text-slate-400 text-xs">${status.by}</p>
                            <p class="text-slate-400 text-xs">${new Date(status.date).toLocaleDateString('pt-BR')}</p>
                            ${status.field === 'os_archived' && status.number ? `<p class="text-yellow-400 text-xs font-bold">OS: ${status.number}</p>` : ''}
                            ${status.hasVideo ? `<button onclick="showVideoPlayerModal('${order.os_finalized_video}', 'V√≠deo da Conclus√£o')" class="text-blue-400 hover:text-blue-300 text-xs font-medium mt-1">‚ñ∂ Ver V√≠deo</button>` : ''}
                          </div>
                        ` : ''}
                      </div>
                    `).join('')}
                  </div>
                </div>
                ${videosArray.length > 0 ? `
                  <div class="bg-red-900/30 border border-red-600 rounded-lg p-3 mb-3">
                    <p class="text-white font-semibold mb-2 text-sm flex items-center gap-2">
                      ÔøΩÔøΩÔøΩ V√≠deos da Obra
                    </p>
                    <div class="space-y-2">
                      ${videosArray.map((vid, i) => `
                        <div class="bg-slate-800/80 rounded p-2 flex items-center justify-between">
                          <div>
                            <p class="text-white text-xs font-medium">${vid.uploaded_by}</p>
                            <p class="text-slate-400 text-xs">${new Date(vid.uploaded_date).toLocaleDateString('pt-BR')}</p>
                          </div>
                          <button onclick="showVideoPlayerModal('${vid.video_data}', 'V√≠deo - ${vid.uploaded_by}')" class="text-red-400 hover:text-red-300 text-xs font-medium">‚ñ∂ Assistir</button>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}
              </div>
              <button onclick="deleteOrder('${order.__backendId}')" class="w-8 h-8 bg-red-500/20 hover:bg-red-500/40 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
            </div>
          </div>
        `;
      }).join('');
    }

    function deleteClient(id) { 
      console.log('üóëÔ∏è Tentando deletar cliente com ID:', id);
      const r = allData.find(d => d.__backendId === id); 
      console.log('üìã Registro encontrado:', r);
      if (r) deleteRecord(r); 
      else console.warn('‚ö†Ô∏è Registro n√£o encontrado em allData');
    }
    function deleteNotice(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }
    function deletePiece(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }
    function deletePhoto(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }
    function deleteVideo(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }
    function deleteOrder(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }

    async function deleteRecord(record) {
      console.log('üì§ Deletando registro:', record);
      const result = await window.dataSdk.delete(record.id || record.__backendId);
      if (result.isOk) { 
        console.log('‚úÖ Registro deletado com sucesso');
        // Atualiza allData e a tela
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
        renderClients(window.dataSdk.storage);
        renderNotices(window.dataSdk.storage);
        showToast('Registro exclu√≠do!');
      }
      else {
        console.error('‚ùå Erro ao deletar:', result.error);
        showToast('Erro ao excluir.', 'error');
      }
    }

    function downloadProject(projectId) {
      const project = allData.find(p => p.__backendId === projectId);
      if (project && project.file_data) {
        let pdfData = project.file_data;
        
        // Se for uma chave do localStorage, recupera o arquivo
        if (!pdfData.startsWith('data:') && !pdfData.startsWith('blob:')) {
          const fromStorage = localStorage.getItem(project.file_data);
          if (fromStorage) {
            pdfData = fromStorage;
          }
        }
        
        if (pdfData && pdfData.startsWith('data:')) {
          const link = document.createElement('a');
          link.href = pdfData;
          link.download = project.file_name || 'projeto.pdf';
          link.click();
          showToast('‚úÖ Download iniciado!');
        } else {
          showToast('‚ùå Arquivo n√£o encontrado', 'error');
        }
      } else {
        showToast('‚ùå Arquivo n√£o encontrado', 'error');
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `fixed bottom-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 ${type === 'error' ? 'bg-red-600' : 'bg-emerald-600'} text-white font-medium`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    async function handleUploadProject(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite de 999 registros atingido.', 'error'); return; }

      const file = document.getElementById('project-file-input').files[0];
      if (!file) { showToast('Selecione um PDF', 'error'); return; }

      // Armazena apenas na mem√≥ria/localStorage, n√£o no banco de dados
      const fileKey = `project_${Date.now()}_${Math.random()}`;
      const reader = new FileReader();
      reader.onload = async (e) => {
        // Salva o arquivo no localStorage
        try {
          localStorage.setItem(fileKey, e.target.result);
        } catch (err) {
          showToast('Arquivo muito grande para salvar. M√°ximo: 5MB', 'error');
          return;
        }

        // Salva apenas metadados no banco
        const result = await window.dataSdk.create({
          type: 'project', file_name: file.name, file_data: fileKey, created_at: new Date().toISOString(),
          client_id: document.getElementById('detail-client-name').textContent, title: '', content: '', client_name: '', piece_name: '', piece_type: '',
          caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', regulagem: false, regulagem_by: '', regulagem_date: '', 
          vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
          photo_description: '', video_description: '', os_title: '', os_date: '', os_solicitante: '', os_description: '', os_video_file: '', os_video_name: '',
          os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
          os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
          os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
        });
        if (result.isOk) { hideUploadProjectModal(); document.getElementById('project-file-input').value = ''; showToast('‚úÖ PDF enviado com sucesso!'); renderProjects(); }
        else showToast('‚ùå Erro ao enviar PDF.', 'error');
      };
      reader.readAsDataURL(file);
    }

      async function uploadFileToFirebase(file, folder = 'uploads') {
        if (!window.FIREBASE_ENABLED || !window.firebase || !firebase.storage) return null;
        const path = `${folder}/${Date.now()}_${file.name.replace(/\s+/g,'_')}`;
        const storageRef = firebase.storage().ref().child(path);
        const snapshot = await storageRef.put(file);
        const url = await snapshot.ref.getDownloadURL();
        return url;
      }

      function isFirebaseAvailable() { return !!(window.FIREBASE_ENABLED && window.firebase && firebase.storage); }

      async function handleUploadPhoto(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite de 999 registros atingido.', 'error'); return; }

      const file = document.getElementById('photo-file-input').files[0];
      const title = document.getElementById('photo-title-input').value.trim();
      const responsible = document.getElementById('photo-responsible-input').value.trim();
      const desc = document.getElementById('photo-description-input').value.trim();
      if (!file) { showToast('Selecione uma foto', 'error'); return; }
      if (!title) { showToast('Digite um t√≠tulo para a foto', 'error'); return; }
      if (!responsible) { showToast('Digite seu nome', 'error'); return; }
        // Se o Firebase estiver configurado, subimos o arquivo e salvamos a URL
        if (isFirebaseAvailable()) {
          try {
            showToast('Enviando foto para o servidor...');
            const url = await uploadFileToFirebase(file, 'photos');
            const result = await window.dataSdk.create({
              type: 'photo', file_data: url, photo_title: title, photo_responsible: responsible, photo_description: desc, created_at: new Date().toISOString(),
              client_id: document.getElementById('detail-client-name').textContent, file_name: file.name
            });
            if (result.isOk) { hideUploadPhotoModal(); document.getElementById('photo-file-input').value = ''; document.getElementById('photo-title-input').value = ''; document.getElementById('photo-responsible-input').value = ''; document.getElementById('photo-description-input').value = ''; showToast('‚úÖ Foto enviada com sucesso!'); allData = window.dataSdk.storage; renderPhotos(); }
            else showToast('‚ùå Erro ao salvar registro.', 'error');
          } catch (err) {
            console.error('Erro no upload Firebase:', err);
            showToast('Erro ao enviar foto para o servidor.', 'error');
          }
          return;
        }

        // Fallback para salvar no localStorage quando Firebase n√£o configurado
        const fileKey = `photo_${Date.now()}_${Math.random()}`;
        const reader = new FileReader();
        reader.onload = async (e) => {
          try {
            localStorage.setItem(fileKey, e.target.result);
          } catch (err) {
            showToast('Arquivo muito grande. M√°ximo: 5MB', 'error');
            return;
          }

          const result = await window.dataSdk.create({
            type: 'photo', file_data: fileKey, photo_title: title, photo_responsible: responsible, photo_description: desc, created_at: new Date().toISOString(),
            client_id: document.getElementById('detail-client-name').textContent, file_name: file.name
          });
          if (result.isOk) { hideUploadPhotoModal(); document.getElementById('photo-file-input').value = ''; document.getElementById('photo-title-input').value = ''; document.getElementById('photo-responsible-input').value = ''; document.getElementById('photo-description-input').value = ''; showToast('‚úÖ Foto enviada com sucesso!'); allData = window.dataSdk.storage; renderPhotos(); }
          else showToast('‚ùå Erro ao enviar foto.', 'error');
        };
        reader.readAsDataURL(file);
    }

    async function handleUploadVideo(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite de 999 registros atingido.', 'error'); return; }

      const file = document.getElementById('video-file-input').files[0];
      const videoName = document.getElementById('video-name-input').value.trim();
      const responsible = document.getElementById('video-responsible-input').value.trim();
      const desc = document.getElementById('video-description-input').value.trim();
      if (!file) { showToast('Selecione um v√≠deo', 'error'); return; }
      if (!videoName) { showToast('Digite um nome para o v√≠deo', 'error'); return; }
      if (!responsible) { showToast('Digite seu nome', 'error'); return; }
      if (!desc) { showToast('Descreva o v√≠deo', 'error'); return; }

      const fileKey = `video_${Date.now()}_${Math.random()}`;
      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          localStorage.setItem(fileKey, e.target.result);
        } catch (err) {
          showToast('Arquivo muito grande. M√°ximo: 5MB', 'error');
          return;
        }

        const result = await window.dataSdk.create({
          type: 'video', file_data: fileKey, file_name: file.name, video_name: videoName, video_responsible: responsible, video_description: desc, created_at: new Date().toISOString(),
          client_id: document.getElementById('detail-client-name').textContent, title: '', content: '', client_name: '',
          piece_name: '', piece_type: '', caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', 
          regulagem: false, regulagem_by: '', regulagem_date: '', vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
          photo_description: '', photo_title: '', photo_responsible: '', os_title: '', os_date: '', os_solicitante: '', os_description: '', os_video_file: '', os_video_name: '',
          os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
          os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
          os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
        });
        if (result.isOk) { 
          hideUploadVideoModal(); 
          document.getElementById('video-file-input').value = ''; 
          document.getElementById('video-name-input').value = ''; 
          document.getElementById('video-responsible-input').value = ''; 
          document.getElementById('video-description-input').value = ''; 
          showToast('‚úÖ V√≠deo enviado com sucesso!'); 
          renderVideos(); 
        }
        else showToast('‚ùå Erro ao enviar v√≠deo.', 'error');
      };
      reader.readAsDataURL(file);
    }

    async function handleAddOrder(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite atingido.', 'error'); return; }

      const videoFile = document.getElementById('os-initial-video-input').files[0];
      let initialVideoData = '';

      if (videoFile) {
        await new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            initialVideoData = e.target.result;
            resolve();
          };
          reader.readAsDataURL(videoFile);
        });
      }

      const result = await window.dataSdk.create({
        type: 'order', os_title: document.getElementById('os-title-input').value.trim(),
        os_date: document.getElementById('os-date-input').value, os_solicitante: document.getElementById('os-solicitante-input').value.trim(),
        os_description: document.getElementById('os-description-input').value.trim(), created_at: new Date().toISOString(),
        os_initial_video: initialVideoData, os_initial_video_name: videoFile ? videoFile.name : '', os_number: '', os_all_videos: '',
        client_id: document.getElementById('detail-client-name').textContent, title: '', content: '', client_name: '',
        piece_name: '', piece_type: '', caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', 
        regulagem: false, regulagem_by: '', regulagem_date: '', vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
        file_name: '', file_data: '', photo_description: '', video_description: '', os_video_file: '', os_video_name: '',
        os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
        os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
        os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
      });
      if (result.isOk) { hideAddOrderModal(); showToast('O.S. criada!'); renderOrders(); }
      else showToast('Erro ao criar.', 'error');
    }

    async function handleAddClient(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite atingido.', 'error'); return; }

      const name = document.getElementById('client-name-input').value.trim();
      const result = await window.dataSdk.create({
        type: 'client', client_name: name, created_at: new Date().toISOString(), title: '', content: '', piece_name: '', piece_type: '',
        caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', regulagem: false, regulagem_by: '', regulagem_date: '',
        vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
        client_id: '', file_name: '', file_data: '', photo_description: '', video_description: '', os_title: '', os_date: '', os_solicitante: '', os_description: '', os_video_file: '', os_video_name: '',
        os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
        os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
        os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
      });
      if (result.isOk) { 
        hideAddClientModal(); 
        document.getElementById('client-name-input').value = '';
        showToast('Cliente adicionado!');
        // Atualiza a tela com os novos dados
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
        renderClients(window.dataSdk.storage);
      }
      else showToast('Erro ao adicionar.', 'error');
    }

    async function handleAddNotice(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite atingido.', 'error'); return; }

      const result = await window.dataSdk.create({
        type: 'notice', title: document.getElementById('notice-title-input').value.trim(),
        content: document.getElementById('notice-content-input').value.trim(), created_at: new Date().toISOString(),
        client_name: '', piece_name: '', piece_type: '', caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '',
        regulagem: false, regulagem_by: '', regulagem_date: '', vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
        client_id: '', file_name: '', file_data: '', photo_description: '', video_description: '', os_title: '', os_date: '', os_solicitante: '', 
        os_description: '', os_video_file: '', os_video_name: '',
        os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
        os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
        os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
      });
      if (result.isOk) { 
        hideAddNoticeModal(); 
        document.getElementById('notice-title-input').value = '';
        document.getElementById('notice-content-input').value = '';
        showToast('Aviso adicionado!');
        // Atualiza a tela com os novos dados
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
        renderNotices(window.dataSdk.storage);
      }
      else showToast('Erro ao adicionar.', 'error');
    }

    async function handleAddPiece(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite atingido.', 'error'); return; }

      const result = await window.dataSdk.create({
        type: 'piece', piece_name: document.getElementById('piece-name-input').value.trim(),
        piece_type: document.getElementById('piece-type-select').value, created_at: new Date().toISOString(),
        client_id: currentClientForChecklist, caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', 
        regulagem: false, regulagem_by: '', regulagem_date: '', vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
        title: '', content: '', client_name: '', file_name: '', file_data: '', photo_description: '', video_description: '',
        os_title: '', os_date: '', os_solicitante: '', os_description: '', os_video_file: '', os_video_name: '',
        os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
        os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
        os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
      });
      if (result.isOk) { 
        hideAddPieceModal(); 
        document.getElementById('piece-name-input').value = '';
        document.getElementById('piece-type-select').value = '';
        showToast('Pe√ßa adicionada!');
        // Atualiza a tela com os novos dados
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
      }
      else showToast('Erro ao adicionar.', 'error');
    }

    const dataHandler = {
      onDataChanged(data) { allData = data; currentRecordCount = data.length; renderClients(data); renderNotices(data); }
    };

    async function onConfigChange(newConfig) {
      config = { ...defaultConfig, ...newConfig };
      const t = document.getElementById('company-title');
      const s = document.getElementById('welcome-subtitle');
      if (t) t.textContent = config.company_name;
      if (s) s.textContent = config.welcome_text;
    }

    function mapToCapabilities(config) { return { recolorables: [], borderables: [], fontEditable: undefined, fontSizeable: undefined }; }
    function mapToEditPanelValues(config) { return new Map([['company_name', config.company_name], ['welcome_text', config.welcome_text]]); }

    async function init() {
      console.log('üîß Iniciando aplica√ß√£o...');
      console.log('üì¶ localStorage jmar_data:', localStorage.getItem('jmar_data'));
      
      if (window.elementSdk) window.elementSdk.init({ defaultConfig, onConfigChange, mapToCapabilities, mapToEditPanelValues });
      if (window.dataSdk) {
        console.log('üìö dataSdk encontrado, iniciando...');
        const result = await window.dataSdk.init(dataHandler);
        console.log('‚úÖ dataSdk init resultado:', result);
        console.log('üìä Dados carregados:', window.dataSdk.storage);
        if (!result.isOk) showToast('Erro ao conectar.', 'error');
      } else {
        console.error('‚ùå dataSdk n√£o encontrado!');
      }
    }
    
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cbd3d580328caef',t:'MTc3MDc0MzYzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Montserrat', sans-serif;
    }
    .nav-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 2px solid transparent; }
    .nav-btn:hover { transform: translateY(-6px); border-color: rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); }
    .client-card { animation: slideUp 0.4s ease-out forwards; opacity: 0; transition: all 0.3s ease; }
    .client-card:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3); }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .action-btn { transition: all 0.2s ease; }
    .action-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3); }
    .back-btn { transition: all 0.2s ease; }
    .back-btn:hover { transform: translateX(-4px); background-color: rgba(255, 255, 255, 0.25) !important; }
    .video-modal { max-height: 80vh; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-slate-900 text-white overflow-auto">
  <div id="app" class="h-full w-full"><!-- Tela de Login -->
   <div id="login-screen" class="h-full w-full flex items-center justify-center p-4">
    <div class="w-full max-w-md">
     <div class="text-center mb-8">
      <div class="w-20 h-20 bg-gradient-to-br from-white to-slate-200 rounded-2xl flex items-center justify-center shadow-lg mx-auto mb-4">
       <svg viewbox="0 0 100 100" class="w-12 h-12"><rect x="15" y="50" width="20" height="35" fill="#1f2937" rx="2" /> <rect x="40" y="35" width="20" height="50" fill="#111827" rx="2" /> <rect x="65" y="20" width="20" height="65" fill="#0f172a" rx="2" /> <path d="M10 85 L90 85" stroke="#e5e7eb" stroke-width="4" stroke-linecap="round" />
       </svg>
      </div>
      <h1 class="text-4xl font-black text-white tracking-tight mb-2">JMAR</h1>
      <p class="text-slate-400 font-medium">Gest√£o de Obras</p>
     </div>
     <div class="bg-slate-800 rounded-2xl p-8 border border-slate-700 shadow-2xl">
      <form onsubmit="handleLogin(event)">
       <div class="mb-4"><label class="text-white font-semibold mb-2 block">Usu√°rio</label> <input type="text" id="login-username" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-blue-500 focus:outline-none" placeholder="Digite seu usu√°rio">
       </div>
       <div class="mb-6"><label class="text-white font-semibold mb-2 block">Senha</label> <input type="password" id="login-password" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-blue-500 focus:outline-none" placeholder="Digite sua senha">
       </div><button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-xl py-3 font-semibold transition-all"> Entrar </button>
      </form>
      <div class="mt-4 text-center">
       <p class="text-slate-400 text-sm">Primeira vez aqui? <button onclick="showRegisterMode()" class="text-blue-400 hover:text-blue-300 font-semibold">Cadastre-se</button></p>
      </div>
     </div>
    </div>
   </div><!-- Tela de Registro -->
   <div id="register-screen" class="h-full w-full flex items-center justify-center p-4 hidden">
    <div class="w-full max-w-md">
     <div class="text-center mb-8">
      <div class="w-20 h-20 bg-gradient-to-br from-white to-slate-200 rounded-2xl flex items-center justify-center shadow-lg mx-auto mb-4">
       <svg viewbox="0 0 100 100" class="w-12 h-12"><rect x="15" y="50" width="20" height="35" fill="#1f2937" rx="2" /> <rect x="40" y="35" width="20" height="50" fill="#111827" rx="2" /> <rect x="65" y="20" width="20" height="65" fill="#0f172a" rx="2" /> <path d="M10 85 L90 85" stroke="#e5e7eb" stroke-width="4" stroke-linecap="round" />
       </svg>
      </div>
      <h1 class="text-4xl font-black text-white tracking-tight mb-2">JMAR</h1>
      <p class="text-slate-400 font-medium">Criar Conta</p>
     </div>
     <div class="bg-slate-800 rounded-2xl p-8 border border-slate-700 shadow-2xl">
      <form onsubmit="handleRegister(event)">
       <div class="mb-4"><label class="text-white font-semibold mb-2 block">Usu√°rio</label> <input type="text" id="register-username" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-green-500 focus:outline-none" placeholder="Escolha um usu√°rio">
       </div>
       <div class="mb-4"><label class="text-white font-semibold mb-2 block">Senha</label> <input type="password" id="register-password" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-green-500 focus:outline-none" placeholder="Crie uma senha">
       </div>
       <div class="mb-6"><label class="text-white font-semibold mb-2 block">Confirmar Senha</label> <input type="password" id="register-password-confirm" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-green-500 focus:outline-none" placeholder="Confirme sua senha">
       </div><button type="submit" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-xl py-3 font-semibold transition-all"> Cadastrar </button>
      </form>
      <div class="mt-4 text-center">
       <p class="text-slate-400 text-sm">J√° tem conta? <button onclick="showLoginMode()" class="text-green-400 hover:text-green-300 font-semibold">Fa√ßa login</button></p>
      </div>
     </div>
    </div>
   </div><!-- Tela Inicial -->
   <div id="home-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-6 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-4">
       <div class="w-16 h-16 bg-gradient-to-br from-white to-slate-200 rounded-2xl flex items-center justify-center shadow-lg">
        <svg viewbox="0 0 100 100" class="w-12 h-12"><rect x="15" y="50" width="20" height="35" fill="#1f2937" rx="2" /> <rect x="40" y="35" width="20" height="50" fill="#111827" rx="2" /> <rect x="65" y="20" width="20" height="65" fill="#0f172a" rx="2" /> <path d="M10 85 L90 85" stroke="#e5e7eb" stroke-width="4" stroke-linecap="round" />
        </svg>
       </div>
       <div>
        <h1 id="company-title" class="text-4xl font-black text-white tracking-tight">JMAR</h1>
        <p id="welcome-subtitle" class="text-slate-400 font-medium text-sm">Gest√£o de Obras</p>
       </div>
      </div><button onclick="logout()" class="bg-red-600 hover:bg-red-500 rounded-xl px-4 py-2 font-semibold text-sm">Sair</button>
     </div>
    </header>
    <main class="flex-1 p-6 flex flex-col items-center justify-center gap-6">
     <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 w-full max-w-3xl"><button onclick="showScreen('obras-screen')" class="nav-btn bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-8 flex flex-col items-center gap-4 shadow-xl border-2 border-slate-700 hover:border-slate-500">
       <div class="w-20 h-20 bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl flex items-center justify-center shadow-lg">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
        </svg>
       </div><span class="text-xl font-bold text-white">Obras</span> </button> <button onclick="showScreen('avisos-screen')" class="nav-btn bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-8 flex flex-col items-center gap-4 shadow-xl border-2 border-slate-700 hover:border-slate-500">
       <div class="w-20 h-20 bg-gradient-to-br from-purple-600 to-purple-700 rounded-2xl flex items-center justify-center shadow-lg">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
       </div><span class="text-xl font-bold text-white">Avisos</span> </button>
     </div>
    </main>
    <footer class="bg-black border-t border-slate-800 p-4 text-center">
     <p class="text-slate-500 text-sm">¬© 2024 JMAR - Todos os direitos reservados</p>
    </footer>
   </div><!-- Tela de Obras -->
   <div id="obras-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('home-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Obras</h1>
       <p class="text-slate-500 text-sm">Gerenciamento de Clientes</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showAddClientModal()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Adicionar Novo Cliente</span> </button>
      <div id="clients-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de Avisos -->
   <div id="avisos-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('home-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Avisos</h1>
       <p class="text-slate-500 text-sm">Comunicados Importantes</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showAddNoticeModal()" class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Adicionar Novo Aviso</span> </button>
      <div id="notices-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de Detalhes do Cliente -->
   <div id="client-detail-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('obras-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 id="detail-client-name" class="text-2xl font-bold text-white">Cliente</h1>
       <p class="text-slate-500 text-sm">Documentos e M√≠dias</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-6 overflow-auto">
     <div class="max-w-4xl mx-auto">
      <div class="grid grid-cols-2 gap-4"><button onclick="showProjectsScreen()" class="action-btn bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
         </svg>
        </div><span class="font-bold text-white text-center">Projetos PDF</span> </button> <button onclick="showPhotosScreen()" class="action-btn bg-gradient-to-br from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
         </svg>
        </div><span class="font-bold text-white text-center">Fotos</span> </button> <button onclick="showVideosScreen()" class="action-btn bg-gradient-to-br from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
         </svg>
        </div><span class="font-bold text-white text-center">V√≠deos</span> </button> <button onclick="showOrdersScreen()" class="action-btn bg-gradient-to-br from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
         </svg>
        </div><span class="font-bold text-white text-center">Ordem de Servi√ßos</span> </button> <button onclick="showChecklistScreen()" class="action-btn bg-gradient-to-br from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-2xl p-6 flex flex-col items-center gap-3 shadow-xl text-white col-span-2">
        <div class="w-16 h-16 bg-white/15 rounded-xl flex items-center justify-center">
         <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg>
        </div><span class="font-bold text-white text-center">Checklist de Instala√ß√£o</span> </button>
      </div>
     </div>
    </main>
   </div><!-- Tela de Projetos -->
   <div id="projects-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Projetos PDF</h1>
       <p class="text-slate-500 text-sm">Gerenciar seus arquivos</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showUploadProjectModal()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Enviar Projeto PDF</span> </button>
      <div id="projects-container" class="space-y-3"></div>
     </div>
    </main>
   </div><!-- Tela de Fotos -->
   <div id="photos-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Fotos</h1>
       <p class="text-slate-500 text-sm">Galeria com descri√ß√µes</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showUploadPhotoModal()" class="w-full bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Enviar Foto</span> </button>
      <div id="photos-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de V√≠deos -->
   <div id="videos-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">V√≠deos</h1>
       <p class="text-slate-500 text-sm">Galeria de v√≠deos</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showUploadVideoModal()" class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Enviar V√≠deo</span> </button>
      <div id="videos-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de Ordem de Servi√ßos -->
   <div id="orders-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Ordem de Servi√ßos</h1>
       <p class="text-slate-500 text-sm">Controle de O.S.</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showAddOrderModal()" class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-500 hover:to-indigo-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Nova Ordem de Servi√ßo</span> </button>
      <div id="orders-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Tela de Checklist -->
   <div id="checklist-screen" class="h-full w-full flex flex-col hidden">
    <header class="bg-black border-b border-slate-800 p-4 shadow-2xl">
     <div class="max-w-4xl mx-auto flex items-center gap-4"><button onclick="showScreen('client-detail-screen')" class="back-btn w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-2xl font-bold text-white">Checklist de Pe√ßas</h1>
       <p class="text-slate-500 text-sm">Controle de Instala√ß√£o</p>
      </div>
     </div>
    </header>
    <main class="flex-1 p-4 overflow-auto">
     <div class="max-w-4xl mx-auto space-y-4"><button onclick="showAddPieceModal()" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-xl p-4 flex items-center justify-center gap-3 shadow-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg><span class="font-semibold">Adicionar Pe√ßa</span> </button>
      <div id="pieces-container" class="space-y-4"></div>
     </div>
    </main>
   </div><!-- Modais -->
   <div id="upload-project-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 class="text-xl font-bold text-white mb-4">Enviar Projeto PDF</h2>
     <form onsubmit="handleUploadProject(event)"><input type="file" id="project-file-input" accept=".pdf" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 file:bg-blue-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1">
      <div class="flex gap-3"><button type="button" onclick="hideUploadProjectModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-500 rounded-xl py-3 font-semibold">Enviar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="upload-photo-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700 max-h-96 overflow-auto">
     <h2 class="text-xl font-bold text-white mb-4">Enviar Foto</h2>
     <form onsubmit="handleUploadPhoto(event)"><input type="file" id="photo-file-input" accept="image/*" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 file:bg-slate-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1"> <input type="text" id="photo-title-input" placeholder="T√≠tulo da foto (ex: Porta 01 - Instala√ß√£o)" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" required> <input type="text" id="photo-responsible-input" placeholder="Seu nome (respons√°vel)" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" required> <textarea id="photo-description-input" required rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 resize-none" placeholder="Descri√ß√£o da foto..."></textarea>
      <div class="flex gap-3"><button type="button" onclick="hideUploadPhotoModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Enviar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="upload-video-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700 max-h-96 overflow-auto">
     <h2 class="text-xl font-bold text-white mb-4">Enviar V√≠deo</h2>
     <form onsubmit="handleUploadVideo(event)"><input type="file" id="video-file-input" accept="video/*" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 file:bg-red-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1"> <input type="text" id="video-name-input" placeholder="Nome do v√≠deo (ex: V√≠deo Instala√ß√£o - Porta 01)" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" required> <input type="text" id="video-responsible-input" placeholder="Seu nome (respons√°vel)" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" required> <textarea id="video-description-input" required rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 resize-none" placeholder="Descri√ß√£o do v√≠deo..."></textarea>
      <div class="flex gap-3"><button type="button" onclick="hideUploadVideoModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-red-600 hover:bg-red-500 rounded-xl py-3 font-semibold">Enviar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="add-order-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700 max-h-96 overflow-auto">
     <h2 class="text-xl font-bold text-white mb-4">Nova Ordem de Servi√ßo</h2>
     <form onsubmit="handleAddOrder(event)"><input type="text" id="os-title-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="T√≠tulo da O.S."> <input type="date" id="os-date-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4"> <input type="text" id="os-solicitante-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Solicitante"> <textarea id="os-description-input" required rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 resize-none" placeholder="Descri√ß√£o..."></textarea>
      <div class="mb-4"><label class="text-white font-semibold mb-2 block">V√≠deo Inicial (Opcional)</label> <input type="file" id="os-initial-video-input" accept="video/*" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white file:bg-slate-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1">
      </div>
      <div class="flex gap-3"><button type="button" onclick="hideAddOrderModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-500 rounded-xl py-3 font-semibold">Criar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="add-piece-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 class="text-xl font-bold text-white mb-4">Adicionar Pe√ßa</h2>
     <form onsubmit="handleAddPiece(event)"><select id="piece-type-select" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 focus:border-green-500"> <option value="">Selecione um tipo...</option> <option value="porta">Porta</option> <option value="janela">Janela</option> <option value="vidro">Vidro</option> <option value="outro">Outro</option> </select> <input type="text" id="piece-name-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Ex: Porta 01, Janela 05">
      <div class="flex gap-3"><button type="button" onclick="hideAddPieceModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-green-600 hover:bg-green-500 rounded-xl py-3 font-semibold">Adicionar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="task-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 id="task-modal-title" class="text-xl font-bold text-white mb-4">Completar Etapa</h2>
     <form onsubmit="handleCompleteTask(event)"><input type="text" id="task-person-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Nome de quem fez"> <input type="date" id="task-date-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4">
      <div class="flex gap-3"><button type="button" onclick="hideTaskModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-green-600 hover:bg-green-500 rounded-xl py-3 font-semibold">Confirmar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="add-client-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 class="text-xl font-bold text-white mb-4">Novo Cliente</h2>
     <form onsubmit="handleAddClient(event)"><input type="text" id="client-name-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Nome do cliente">
      <div class="flex gap-3"><button type="button" onclick="hideAddClientModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-emerald-600 hover:bg-emerald-500 rounded-xl py-3 font-semibold">Adicionar</button>
      </div>
     </form>
    </div>
   </div>
   <div id="add-notice-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700">
     <h2 class="text-xl font-bold text-white mb-4">Novo Aviso</h2>
     <form onsubmit="handleAddNotice(event)"><input type="text" id="notice-title-input" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="T√≠tulo"> <textarea id="notice-content-input" required rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4 resize-none" placeholder="Conte√∫do..."></textarea>
      <div class="flex gap-3"><button type="button" onclick="hideAddNoticeModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-rose-600 hover:bg-rose-500 rounded-xl py-3 font-semibold">Adicionar</button>
      </div>
     </form>
    </div>
   </div><!-- Modal para Status da OS -->
   <div id="os-status-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl border border-slate-700 max-h-96 overflow-auto">
     <h2 id="os-status-title" class="text-xl font-bold text-white mb-4">Atualizar Status</h2>
     <form onsubmit="handleOSStatusChange(event)"><input type="text" id="os-status-person" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4" placeholder="Nome"> <input type="date" id="os-status-date" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white mb-4">
      <div id="os-number-container" class="mb-4 hidden"><label class="text-white font-semibold mb-2 block">N√∫mero da OS</label> <input type="text" id="os-number-input" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white" placeholder="Digite o n√∫mero">
      </div>
      <div id="os-status-video-container" class="mb-4 hidden"><label class="text-white font-semibold mb-2 block">V√≠deo</label> <input type="file" id="os-status-video" accept="video/*" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 text-white file:bg-slate-600 file:text-white file:border-0 file:rounded file:px-3 file:py-1">
      </div>
      <div class="flex gap-3"><button type="button" onclick="hideOSStatusModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-semibold">Cancelar</button> <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-500 rounded-xl py-3 font-semibold">Confirmar</button>
      </div>
     </form>
    </div>
   </div><!-- Modal de Visualiza√ß√£o de V√≠deo -->
   <div id="video-player-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-2xl shadow-2xl border border-slate-700">
     <div class="flex items-center justify-between mb-4">
      <h2 id="video-player-title" class="text-xl font-bold text-white">V√≠deo</h2><button onclick="hideVideoPlayerModal()" class="text-slate-400 hover:text-white">√ó</button>
     </div>
     <video id="video-player" controls class="w-full rounded-lg bg-black"></video>
    </div>
   </div><!-- Modal de Visualiza√ß√£o de Foto -->
   <div id="photo-viewer-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-3xl shadow-2xl border border-slate-700">
     <div class="flex items-center justify-between mb-4">
      <h2 id="photo-viewer-title" class="text-xl font-bold text-white">Foto</h2><button onclick="hidePhotoViewerModal()" class="text-slate-400 hover:text-white text-2xl">√ó</button>
     </div>
     <div class="bg-black rounded-lg overflow-hidden"><img id="photo-viewer-image" src="" alt="Foto" class="w-full h-auto max-h-96 object-contain">
     </div>
     <p id="photo-viewer-description" class="text-white mt-4 text-sm"></p>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = { company_name: 'JMAR', welcome_text: 'Gest√£o de Obras' };
    let config = { ...defaultConfig };
    let allData = [];
    let currentRecordCount = 0;
    let currentClientForChecklist = null;
    let currentUser = null;
    let users = JSON.parse(localStorage.getItem('jmar_users')) || {};
    let currentTaskData = { pieceId: null, taskField: null };
    let currentOSStatusData = { orderId: null, statusField: null };

    function showLoginMode() {
      document.getElementById('register-screen').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
    }

    function showRegisterMode() {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('register-screen').classList.remove('hidden');
    }

    function handleLogin(event) {
      event.preventDefault();
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value.trim();

      if (users[username] && users[username] === password) {
        currentUser = username;
        document.getElementById('login-screen').classList.add('hidden');
        showScreen('home-screen');
        showToast(`Bem-vindo, ${username}!`);
      } else {
        showToast('Usu√°rio ou senha incorretos!', 'error');
      }
    }

    function handleRegister(event) {
      event.preventDefault();
      const username = document.getElementById('register-username').value.trim();
      const password = document.getElementById('register-password').value.trim();
      const confirm = document.getElementById('register-password-confirm').value.trim();

      if (username.length < 3) {
        showToast('Usu√°rio deve ter pelo menos 3 caracteres!', 'error');
        return;
      }
      if (password.length < 4) {
        showToast('Senha deve ter pelo menos 4 caracteres!', 'error');
        return;
      }
      if (password !== confirm) {
        showToast('Senhas n√£o coincidem!', 'error');
        return;
      }
      if (users[username]) {
        showToast('Usu√°rio j√° existe!', 'error');
        return;
      }

      users[username] = password;
      localStorage.setItem('jmar_users', JSON.stringify(users));
      showToast('Conta criada com sucesso!');
      showLoginMode();
      document.getElementById('register-username').value = '';
      document.getElementById('register-password').value = '';
      document.getElementById('register-password-confirm').value = '';
    }

    function logout() {
      currentUser = null;
      document.getElementById('login-screen').classList.remove('hidden');
      showScreen('login-screen');
      document.getElementById('login-username').value = '';
      document.getElementById('login-password').value = '';
    }

    function showScreen(screenId) {
      console.log('üé¨ Mudando para tela:', screenId);
      ['home-screen', 'obras-screen', 'avisos-screen', 'client-detail-screen', 'checklist-screen', 'projects-screen', 'photos-screen', 'videos-screen', 'orders-screen'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(screenId).classList.remove('hidden');
      
      // Sempre carrega dados do localStorage quando muda de tela
      if (window.dataSdk && window.dataSdk.storage) {
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
        console.log('üìä Dados carregados para tela:', allData.length, 'registros');
      } else {
        console.warn('‚ö†Ô∏è dataSdk n√£o dispon√≠vel ou storage vazio');
      }
      
      // Renderiza clientes e avisos quando a tela de obras √© exibida
      if (screenId === 'obras-screen') {
        console.log('üë∑ Renderizando clientes e avisos...');
        renderClients(allData);
        renderNotices(allData);
      }
    }

    function showClientDetail(clientName) {
      document.getElementById('detail-client-name').textContent = clientName;
      showScreen('client-detail-screen');
    }

    function showChecklistScreen() {
      currentClientForChecklist = document.getElementById('detail-client-name').textContent;
      showScreen('checklist-screen');
      renderPieces();
    }

    function showProjectsScreen() { showScreen('projects-screen'); renderProjects(); }
    function showPhotosScreen() { showScreen('photos-screen'); renderPhotos(); }
    function showVideosScreen() { showScreen('videos-screen'); renderVideos(); }
    function showOrdersScreen() { showScreen('orders-screen'); renderOrders(); }

    function showAddClientModal() { document.getElementById('add-client-modal').classList.remove('hidden'); }
    function hideAddClientModal() { document.getElementById('add-client-modal').classList.add('hidden'); }
    function showAddNoticeModal() { document.getElementById('add-notice-modal').classList.remove('hidden'); }
    function hideAddNoticeModal() { document.getElementById('add-notice-modal').classList.add('hidden'); }
    function showAddPieceModal() { document.getElementById('add-piece-modal').classList.remove('hidden'); }
    function hideAddPieceModal() { document.getElementById('add-piece-modal').classList.add('hidden'); }
    function showUploadProjectModal() { document.getElementById('upload-project-modal').classList.remove('hidden'); }
    function hideUploadProjectModal() { document.getElementById('upload-project-modal').classList.add('hidden'); }
    function showUploadPhotoModal() { document.getElementById('upload-photo-modal').classList.remove('hidden'); }
    function hideUploadPhotoModal() { document.getElementById('upload-photo-modal').classList.add('hidden'); }
    function showUploadVideoModal() { document.getElementById('upload-video-modal').classList.remove('hidden'); }
    function hideUploadVideoModal() { document.getElementById('upload-video-modal').classList.add('hidden'); }
    function showAddOrderModal() { document.getElementById('add-order-modal').classList.remove('hidden'); }
    function hideAddOrderModal() { document.getElementById('add-order-modal').classList.add('hidden'); }

    function showTaskModal(pieceId, taskField, taskName) {
      currentTaskData = { pieceId, taskField };
      document.getElementById('task-modal-title').textContent = `Completar: ${taskName}`;
      document.getElementById('task-person-input').value = '';
      document.getElementById('task-date-input').value = new Date().toISOString().split('T')[0];
      document.getElementById('task-modal').classList.remove('hidden');
    }

    function hideTaskModal() { document.getElementById('task-modal').classList.add('hidden'); }

    function showOSStatusModal(orderId, statusField, statusName) {
      currentOSStatusData = { orderId, statusField };
      document.getElementById('os-status-title').textContent = statusName;
      document.getElementById('os-status-person').value = '';
      document.getElementById('os-status-date').value = new Date().toISOString().split('T')[0];
      document.getElementById('os-status-video').value = '';
      document.getElementById('os-number-input').value = '';
      
      // Mostrar input de n√∫mero apenas para Arquivado
      const numberContainer = document.getElementById('os-number-container');
      if (statusField === 'os_archived') {
        numberContainer.classList.remove('hidden');
      } else {
        numberContainer.classList.add('hidden');
      }
      
      // Mostrar input de v√≠deo para Obra Finalizada
      const videoContainer = document.getElementById('os-status-video-container');
      if (statusField === 'os_finalized') {
        videoContainer.classList.remove('hidden');
      } else {
        videoContainer.classList.add('hidden');
      }
      
      document.getElementById('os-status-modal').classList.remove('hidden');
    }

    function hideOSStatusModal() { document.getElementById('os-status-modal').classList.add('hidden'); }

    function showVideoPlayerModal(videoData, videoName) {
      let videoSrc = videoData;
      
      // Se for uma chave do localStorage, recupera o arquivo
      if (videoData && !videoData.startsWith('data:') && !videoData.startsWith('blob:')) {
        const fromStorage = localStorage.getItem(videoData);
        if (fromStorage) {
          videoSrc = fromStorage;
        }
      }
      
      document.getElementById('video-player-title').textContent = videoName || 'V√≠deo';
      document.getElementById('video-player').src = videoSrc;
      document.getElementById('video-player-modal').classList.remove('hidden');
    }

    function hideVideoPlayerModal() { document.getElementById('video-player-modal').classList.add('hidden'); }

    function showPhotoViewerModal(photoData, photoDescription, photoTitle = '', photoResponsible = '') {
      document.getElementById('photo-viewer-image').src = photoData;
      document.getElementById('photo-viewer-title').textContent = photoTitle || 'Foto';
      document.getElementById('photo-viewer-description').innerHTML = `${photoDescription}${photoResponsible ? `<p class="text-blue-400 text-xs mt-2">Por: ${photoResponsible}</p>` : ''}`;
      document.getElementById('photo-viewer-modal').classList.remove('hidden');
    }

    function hidePhotoViewerModal() { document.getElementById('photo-viewer-modal').classList.add('hidden'); }

    async function handleCompleteTask(event) {
      event.preventDefault();
      const person = document.getElementById('task-person-input').value.trim();
      const date = document.getElementById('task-date-input').value;
      const { pieceId, taskField } = currentTaskData;

      const piece = allData.find(p => p.__backendId === pieceId);
      if (piece) {
        const updatedPiece = {
          ...piece,
          [taskField]: true,
          [`${taskField}_by`]: person,
          [`${taskField}_date`]: date
        };
        const result = await window.dataSdk.update(updatedPiece);
        if (result.isOk) {
          hideTaskModal();
          showToast(`Etapa "${taskField}" conclu√≠da por ${person}!`);
          renderPieces();
        } else {
          showToast('Erro ao atualizar pe√ßa.', 'error');
        }
      }
    }

    async function handleOSStatusChange(event) {
      event.preventDefault();
      const person = document.getElementById('os-status-person').value.trim();
      const date = document.getElementById('os-status-date').value;
      const videoFile = document.getElementById('os-status-video').files[0];
      const osNumber = document.getElementById('os-number-input').value.trim();
      const { orderId, statusField } = currentOSStatusData;

      const order = allData.find(o => o.__backendId === orderId);
      if (order) {
        const updates = {
          ...order,
          [statusField]: true,
          [`${statusField}_by`]: person,
          [`${statusField}_date`]: date
        };

        // Se for arquivado, salva o n√∫mero
        if (statusField === 'os_archived' && osNumber) {
          updates.os_number = osNumber;
        }

        // Processa v√≠deo apenas para Obra Finalizada
        if (statusField === 'os_finalized' && videoFile) {
          const reader = new FileReader();
          reader.onload = async (e) => {
            updates.os_finalized_video = e.target.result;
            updates.os_finalized_video_name = videoFile.name;
            
            // Adiciona informa√ß√£o do v√≠deo na lista
            const videosArray = order.os_all_videos ? JSON.parse(order.os_all_videos) : [];
            videosArray.push({
              video_data: e.target.result,
              video_name: videoFile.name,
              uploaded_by: person,
              uploaded_date: date
            });
            updates.os_all_videos = JSON.stringify(videosArray);
            
            const result = await window.dataSdk.update(updates);
            if (result.isOk) {
              hideOSStatusModal();
              showToast('Status atualizado com sucesso!');
              renderOrders();
            } else {
              showToast('Erro ao atualizar.', 'error');
            }
          };
          reader.readAsDataURL(videoFile);
        } else {
          const result = await window.dataSdk.update(updates);
          if (result.isOk) {
            hideOSStatusModal();
            showToast('Status atualizado com sucesso!');
            renderOrders();
          } else {
            showToast('Erro ao atualizar.', 'error');
          }
        }
      }
    }

    function renderClients(data) {
      const container = document.getElementById('clients-container');
      const clients = data.filter(item => item.type === 'client');
      
      if (clients.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhum cliente cadastrado</p></div>';
        return;
      }

      container.innerHTML = clients.map((client, index) => `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.1}s">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center text-white font-bold">${client.client_name.charAt(0)}</div>
              <div><h3 class="font-bold text-white text-lg">${client.client_name}</h3><p class="text-slate-500 text-sm">${new Date(client.created_at).toLocaleDateString('pt-BR')}</p></div>
            </div>
            <button onclick="deleteClient('${client.id || client.__backendId}')" class="w-8 h-8 bg-red-500/20 hover:bg-red-500/40 rounded-lg flex items-center justify-center">
              <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            </button>
          </div>
          <div class="grid grid-cols-4 gap-2">
            <button onclick="showClientDetail('${client.client_name}')" class="bg-blue-600 hover:bg-blue-500 rounded-lg py-2 px-3 text-xs font-medium">Projetos</button>
            <button onclick="showClientDetail('${client.client_name}')" class="bg-slate-700 hover:bg-slate-600 rounded-lg py-2 px-3 text-xs font-medium">Fotos</button>
            <button onclick="showClientDetail('${client.client_name}')" class="bg-slate-700 hover:bg-slate-600 rounded-lg py-2 px-3 text-xs font-medium">V√≠deos</button>
            <button onclick="showClientDetail('${client.client_name}')" class="bg-slate-700 hover:bg-slate-600 rounded-lg py-2 px-3 text-xs font-medium">O.S.</button>
          </div>
        </div>
      `).join('');
    }

    function renderNotices(data) {
      const container = document.getElementById('notices-container');
      const notices = data.filter(item => item.type === 'notice');
      
      if (notices.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhum aviso cadastrado</p></div>';
        return;
      }

      container.innerHTML = notices.map((notice, index) => `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.1}s">
          <div class="flex items-start justify-between gap-4">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-gradient-to-br from-rose-400 to-pink-500 rounded-xl flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg></div>
                <div><h3 class="font-bold text-white">${notice.title}</h3><p class="text-slate-400 text-xs">${new Date(notice.created_at).toLocaleDateString('pt-BR')}</p></div>
              </div>
              <p class="text-slate-300 text-sm">${notice.content}</p>
            </div>
            <button onclick="deleteNotice('${notice.__backendId}')" class="w-8 h-8 bg-red-500/20 hover:bg-red-500/40 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
          </div>
        </div>
      `).join('');
    }

    function renderPieces() {
      const container = document.getElementById('pieces-container');
      const pieces = allData.filter(item => item.type === 'piece' && item.client_id === currentClientForChecklist);
      
      if (pieces.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhuma pe√ßa adicionada</p></div>';
        return;
      }

      container.innerHTML = pieces.map((piece, index) => {
        const isCompleted = piece.caixilho && piece.vidro && piece.regulagem && piece.vedacao && piece.arremate;
        const completedTasks = [piece.caixilho, piece.vidro, piece.regulagem, piece.vedacao, piece.arremate].filter(Boolean).length;
        const totalTasks = 5;

        const tasks = [
          { field: 'caixilho', label: '1. Caixilho', by: piece.caixilho_by, date: piece.caixilho_date, completed: piece.caixilho },
          { field: 'vidro', label: '2. Vidro', by: piece.vidro_by, date: piece.vidro_date, completed: piece.vidro },
          { field: 'regulagem', label: '3. Regulagem', by: piece.regulagem_by, date: piece.regulagem_date, completed: piece.regulagem },
          { field: 'vedacao', label: '4. Veda√ß√£o', by: piece.vedacao_by, date: piece.vedacao_date, completed: piece.vedacao },
          { field: 'arremate', label: '5. Arremate', by: piece.arremate_by, date: piece.arremate_date, completed: piece.arremate }
        ];

        return `
          <div class="client-card bg-slate-800 rounded-2xl p-5 border-2 ${isCompleted ? 'border-green-500 bg-green-900/20' : 'border-orange-500 bg-orange-900/10'} shadow-lg" style="animation-delay: ${index * 0.05}s">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-gradient-to-br ${isCompleted ? 'from-green-400 to-green-600' : 'from-orange-400 to-orange-600'} rounded-xl flex items-center justify-center text-white font-bold">${isCompleted ? '‚úì' : totalTasks - completedTasks}</div>
                <div><h3 class="font-bold text-white text-lg capitalize">${piece.piece_type} - ${piece.piece_name}</h3><p class="text-slate-500 text-sm">${completedTasks}/${totalTasks} etapas</p></div>
              </div>
              <button onclick="deletePiece('${piece.__backendId}')" class="w-8 h-8 bg-red-500/20 hover:bg-red-500/40 rounded-lg flex items-center justify-center"><svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
            </div>
            <div class="mb-4"><div class="w-full bg-slate-700 rounded-full h-2 overflow-hidden"><div class="bg-gradient-to-r from-orange-500 to-green-500 h-full rounded-full" style="width: ${(completedTasks / totalTasks) * 100}%"></div></div></div>
            <div class="grid grid-cols-1 gap-2">
              ${tasks.map(task => `
                <div class="${task.completed ? 'bg-green-900/30 border border-green-600' : 'hover:bg-slate-700/50'} rounded-lg p-3 transition-all">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                      <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="showTaskModal('${piece.__backendId}', '${task.field}', '${task.label}')" class="w-5 h-5 rounded cursor-pointer">
                      <span class="text-white font-medium">${task.label}</span>
                    </div>
                    ${task.completed ? '<span class="text-xs bg-green-600 text-white px-2 py-1 rounded">‚úì</span>' : ''}
                  </div>
                  ${task.completed ? `<p class="text-slate-400 text-xs ml-8">Realizado por <strong>${task.by}</strong> em ${new Date(task.date).toLocaleDateString('pt-BR')}</p>` : ''}
                </div>
              `).join('')}
            </div>
            ${isCompleted ? '<div class="mt-4 p-3 bg-green-600/30 border border-green-500 rounded-lg text-green-300 font-bold">Pe√ßa Finalizada! ‚úì</div>' : '<div class="mt-4 p-3 bg-orange-600/30 border border-orange-500 rounded-lg text-orange-300 font-bold">Pendente - ' + (totalTasks - completedTasks) + ' etapa' + (totalTasks - completedTasks !== 1 ? 's' : '') + '</div>'}
          </div>
        `;
      }).join('');
    }

    function renderProjects() {
      const container = document.getElementById('projects-container');
      const clientName = document.getElementById('detail-client-name').textContent;
      const projects = allData.filter(item => item.type === 'project' && item.client_id === clientName);
      
      if (projects.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhum projeto enviado</p></div>';
        return;
      }

      container.innerHTML = projects.map((proj, index) => `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.05}s">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-gradient-to-br from-red-400 to-red-600 rounded-xl flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg></div>
              <div><h3 class="font-bold text-white">${proj.file_name}</h3><p class="text-slate-500 text-sm">${new Date(proj.created_at).toLocaleDateString('pt-BR')}</p></div>
            </div>
            <button onclick="downloadProject('${proj.__backendId}')" class="w-10 h-10 bg-blue-600 hover:bg-blue-500 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg></button>
          </div>
        </div>
      `).join('');
    }

    function renderPhotos() {
      const container = document.getElementById('photos-container');
      const clientName = document.getElementById('detail-client-name').textContent;
      const photos = allData.filter(item => item.type === 'photo' && item.client_id === clientName);
      
      if (photos.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhuma foto enviada</p></div>';
        return;
      }

      container.innerHTML = photos.map((photo, index) => {
        const photoData = localStorage.getItem(photo.file_data) || photo.file_data;
        const photoTitle = photo.photo_title || 'Foto sem t√≠tulo';
        return `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.05}s">
          <div class="flex items-start gap-4">
            <div class="w-24 h-24 bg-slate-700 rounded-lg overflow-hidden flex-shrink-0 cursor-pointer hover:opacity-80 transition-opacity" onclick="showPhotoViewerModal('${photoData}', '${photo.photo_description}', '${photoTitle}', '${photo.photo_responsible}')">
              <img src="${photoData}" alt="Foto" class="w-full h-full object-cover" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 fill=%22%23666%22 viewBox=%220 0 24 24%22%3E%3Cpath d=%22M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z/%3E%3C/svg%3E'">
            </div>
            <div class="flex-1">
              <h3 class="font-bold text-white text-sm">${photoTitle}</h3>
              <p class="text-slate-500 text-xs">Por: <span class="text-blue-400">${photo.photo_responsible || 'N√£o informado'}</span></p>
              <p class="text-slate-400 text-xs mt-1">${new Date(photo.created_at).toLocaleDateString('pt-BR')}</p>
              <p class="text-white mt-2 text-xs">${photo.photo_description}</p>
              <div class="flex gap-2 mt-3">
                <button onclick="showPhotoViewerModal('${photoData}', '${photo.photo_description}', '${photoTitle}', '${photo.photo_responsible}')" class="text-blue-400 hover:text-blue-300 text-sm font-medium">üëÅÔ∏è Ver Foto</button>
                <button onclick="deletePhoto('${photo.__backendId}')" class="text-red-400 hover:text-red-300 text-sm font-medium">üóëÔ∏è Excluir</button>
              </div>
            </div>
          </div>
        </div>
      `}).join('');
    }

    function renderVideos() {
      const container = document.getElementById('videos-container');
      const clientName = document.getElementById('detail-client-name').textContent;
      const videos = allData.filter(item => item.type === 'video' && item.client_id === clientName);
      
      if (videos.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhum v√≠deo enviado</p></div>';
        return;
      }

      container.innerHTML = videos.map((video, index) => {
        const videoData = localStorage.getItem(video.file_data) || video.file_data;
        const videoTitle = video.video_name || video.file_name || 'V√≠deo';
        return `
        <div class="client-card bg-slate-800 rounded-2xl p-5 border border-slate-700 shadow-lg" style="animation-delay: ${index * 0.05}s">
          <div class="flex items-start gap-4">
            <div class="w-24 h-24 bg-slate-700 rounded-lg overflow-hidden flex-shrink-0 flex items-center justify-center">
              <svg class="w-12 h-12 text-red-400" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </div>
            <div class="flex-1">
              <h3 class="font-bold text-white text-sm">${videoTitle}</h3>
              <p class="text-slate-500 text-xs">Por: <span class="text-blue-400">${video.video_responsible || 'N√£o informado'}</span></p>
              <p class="text-slate-400 text-xs mt-1">${new Date(video.created_at).toLocaleDateString('pt-BR')}</p>
              <p class="text-white mt-2 text-xs">${video.video_description}</p>
              <div class="flex gap-2 mt-3">
                <button onclick="showVideoPlayerModal('${videoData}', '${videoTitle}')" class="text-blue-400 hover:text-blue-300 text-sm font-medium">‚ñ∂ Assistir</button>
                <button onclick="deleteVideo('${video.__backendId}')" class="text-red-400 hover:text-red-300 text-sm font-medium">Excluir</button>
              </div>
            </div>
          </div>
        </div>
      `}).join('');
    }

    function renderOrders() {
      const container = document.getElementById('orders-container');
      const clientName = document.getElementById('detail-client-name').textContent;
      const orders = allData.filter(item => item.type === 'order' && item.client_id === clientName);
      
      if (orders.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>Nenhuma ordem de servi√ßo criada</p></div>';
        return;
      }

      container.innerHTML = orders.map((order, index) => {
        const allStatusCompleted = order.os_archived && order.os_produced && order.os_material_separated && order.os_finalized;
        const videosArray = order.os_all_videos ? JSON.parse(order.os_all_videos) : [];
        
        const statusArray = [
          { name: '1Ô∏èÔøΩÔøΩÔøΩ Arquivado', completed: order.os_archived, field: 'os_archived', by: order.os_archived_by, date: order.os_archived_date, hasVideo: false, number: order.os_number || '' },
          { name: '2Ô∏è‚É£ Produzido', completed: order.os_produced, field: 'os_produced', by: order.os_produced_by, date: order.os_produced_date, hasVideo: false },
          { name: '3Ô∏è‚É£ Material Separado', completed: order.os_material_separated, field: 'os_material_separated', by: order.os_material_by, date: order.os_material_date, hasVideo: false },
          { name: '4Ô∏è‚É£ Obra Finalizada', completed: order.os_finalized, field: 'os_finalized', by: order.os_finalized_by, date: order.os_finalized_date, hasVideo: !!order.os_finalized_video }
        ];

        return `
          <div class="client-card bg-slate-800 rounded-2xl p-5 border-2 ${allStatusCompleted ? 'border-green-500 bg-green-900/10' : 'border-indigo-500'} shadow-lg" style="animation-delay: ${index * 0.05}s">
            <div class="flex items-start justify-between mb-3">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h3 class="font-bold text-white text-lg">${order.os_title}</h3>
                  <span class="${allStatusCompleted ? 'bg-green-600' : 'bg-indigo-600'} text-white text-xs px-3 py-1 rounded-full">${allStatusCompleted ? '‚úì Conclu√≠do' : 'Em Progresso'}</span>
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm mb-3">
                  <div><p class="text-slate-400">Data:</p><p class="text-white font-medium">${order.os_date}</p></div>
                  <div><p class="text-slate-400">Solicitante:</p><p class="text-white font-medium">${order.os_solicitante}</p></div>
                </div>
                <div class="mb-3">
                  <p class="text-slate-400 text-sm">Descri√ß√£o:</p>
                  <p class="text-white mt-1 text-sm">${order.os_description}</p>
                </div>
                ${order.os_initial_video ? `
                  <div class="bg-blue-900/30 border border-blue-600 rounded-lg p-2 mb-3">
                    <button onclick="showVideoPlayerModal('${order.os_initial_video}', 'V√≠deo Inicial da O.S.')" class="text-blue-400 hover:text-blue-300 text-sm font-medium flex items-center gap-2">
                      ‚ñ∂ Ver V√≠deo Inicial
                    </button>
                  </div>
                ` : ''}
                <div class="bg-slate-900/50 rounded-lg p-3 mb-3 border border-slate-700">
                  <p class="text-white font-semibold mb-2 text-sm">Status da Execu√ß√£o:</p>
                  <div class="space-y-2">
                    ${statusArray.map(status => `
                      <div class="flex items-center justify-between p-2 rounded ${status.completed ? 'bg-green-900/30 border border-green-600' : 'hover:bg-slate-700/50'}">
                        <div class="flex items-center gap-2">
                          <input type="checkbox" ${status.completed ? 'checked' : ''} onchange="showOSStatusModal('${order.__backendId}', '${status.field}', '${status.name}')" class="w-4 h-4 rounded cursor-pointer">
                          <span class="text-white text-sm">${status.name}</span>
                          ${status.completed ? '<span class="text-xs bg-green-600 text-white px-2 py-1 rounded">‚úì</span>' : ''}
                        </div>
                        ${status.completed ? `
                          <div class="text-right">
                            <p class="text-slate-400 text-xs">${status.by}</p>
                            <p class="text-slate-400 text-xs">${new Date(status.date).toLocaleDateString('pt-BR')}</p>
                            ${status.field === 'os_archived' && status.number ? `<p class="text-yellow-400 text-xs font-bold">OS: ${status.number}</p>` : ''}
                            ${status.hasVideo ? `<button onclick="showVideoPlayerModal('${order.os_finalized_video}', 'V√≠deo da Conclus√£o')" class="text-blue-400 hover:text-blue-300 text-xs font-medium mt-1">‚ñ∂ Ver V√≠deo</button>` : ''}
                          </div>
                        ` : ''}
                      </div>
                    `).join('')}
                  </div>
                </div>
                ${videosArray.length > 0 ? `
                  <div class="bg-red-900/30 border border-red-600 rounded-lg p-3 mb-3">
                    <p class="text-white font-semibold mb-2 text-sm flex items-center gap-2">
                      ÔøΩÔøΩÔøΩ V√≠deos da Obra
                    </p>
                    <div class="space-y-2">
                      ${videosArray.map((vid, i) => `
                        <div class="bg-slate-800/80 rounded p-2 flex items-center justify-between">
                          <div>
                            <p class="text-white text-xs font-medium">${vid.uploaded_by}</p>
                            <p class="text-slate-400 text-xs">${new Date(vid.uploaded_date).toLocaleDateString('pt-BR')}</p>
                          </div>
                          <button onclick="showVideoPlayerModal('${vid.video_data}', 'V√≠deo - ${vid.uploaded_by}')" class="text-red-400 hover:text-red-300 text-xs font-medium">‚ñ∂ Assistir</button>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}
              </div>
              <button onclick="deleteOrder('${order.__backendId}')" class="w-8 h-8 bg-red-500/20 hover:bg-red-500/40 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
            </div>
          </div>
        `;
      }).join('');
    }

    function deleteClient(id) { 
      console.log('üóëÔ∏è Tentando deletar cliente com ID:', id);
      const r = allData.find(d => d.__backendId === id); 
      console.log('üìã Registro encontrado:', r);
      if (r) deleteRecord(r); 
      else console.warn('‚ö†Ô∏è Registro n√£o encontrado em allData');
    }
    function deleteNotice(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }
    function deletePiece(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }
    function deletePhoto(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }
    function deleteVideo(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }
    function deleteOrder(id) { const r = allData.find(d => d.__backendId === id); if (r) deleteRecord(r); }

    async function deleteRecord(record) {
      console.log('üì§ Deletando registro:', record);
      const result = await window.dataSdk.delete(record.id || record.__backendId);
      if (result.isOk) { 
        console.log('‚úÖ Registro deletado com sucesso');
        // Atualiza allData e a tela
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
        renderClients(window.dataSdk.storage);
        renderNotices(window.dataSdk.storage);
        showToast('Registro exclu√≠do!');
      }
      else {
        console.error('‚ùå Erro ao deletar:', result.error);
        showToast('Erro ao excluir.', 'error');
      }
    }

    function downloadProject(projectId) {
      const project = allData.find(p => p.__backendId === projectId);
      if (project && project.file_data) {
        let pdfData = project.file_data;
        
        // Se for uma chave do localStorage, recupera o arquivo
        if (!pdfData.startsWith('data:') && !pdfData.startsWith('blob:')) {
          const fromStorage = localStorage.getItem(project.file_data);
          if (fromStorage) {
            pdfData = fromStorage;
          }
        }
        
        if (pdfData && pdfData.startsWith('data:')) {
          const link = document.createElement('a');
          link.href = pdfData;
          link.download = project.file_name || 'projeto.pdf';
          link.click();
          showToast('‚úÖ Download iniciado!');
        } else {
          showToast('‚ùå Arquivo n√£o encontrado', 'error');
        }
      } else {
        showToast('‚ùå Arquivo n√£o encontrado', 'error');
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `fixed bottom-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 ${type === 'error' ? 'bg-red-600' : 'bg-emerald-600'} text-white font-medium`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    async function handleUploadProject(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite de 999 registros atingido.', 'error'); return; }

      const file = document.getElementById('project-file-input').files[0];
      if (!file) { showToast('Selecione um PDF', 'error'); return; }

      // Armazena apenas na mem√≥ria/localStorage, n√£o no banco de dados
      const fileKey = `project_${Date.now()}_${Math.random()}`;
      const reader = new FileReader();
      reader.onload = async (e) => {
        // Salva o arquivo no localStorage
        try {
          localStorage.setItem(fileKey, e.target.result);
        } catch (err) {
          showToast('Arquivo muito grande para salvar. M√°ximo: 5MB', 'error');
          return;
        }

        // Salva apenas metadados no banco
        const result = await window.dataSdk.create({
          type: 'project', file_name: file.name, file_data: fileKey, created_at: new Date().toISOString(),
          client_id: document.getElementById('detail-client-name').textContent, title: '', content: '', client_name: '', piece_name: '', piece_type: '',
          caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', regulagem: false, regulagem_by: '', regulagem_date: '', 
          vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
          photo_description: '', video_description: '', os_title: '', os_date: '', os_solicitante: '', os_description: '', os_video_file: '', os_video_name: '',
          os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
          os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
          os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
        });
        if (result.isOk) { hideUploadProjectModal(); document.getElementById('project-file-input').value = ''; showToast('‚úÖ PDF enviado com sucesso!'); renderProjects(); }
        else showToast('‚ùå Erro ao enviar PDF.', 'error');
      };
      reader.readAsDataURL(file);
    }

    async function handleUploadPhoto(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite de 999 registros atingido.', 'error'); return; }

      const file = document.getElementById('photo-file-input').files[0];
      const title = document.getElementById('photo-title-input').value.trim();
      const responsible = document.getElementById('photo-responsible-input').value.trim();
      const desc = document.getElementById('photo-description-input').value.trim();
      if (!file) { showToast('Selecione uma foto', 'error'); return; }
      if (!title) { showToast('Digite um t√≠tulo para a foto', 'error'); return; }
      if (!responsible) { showToast('Digite seu nome', 'error'); return; }

      const fileKey = `photo_${Date.now()}_${Math.random()}`;
      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          localStorage.setItem(fileKey, e.target.result);
        } catch (err) {
          showToast('Arquivo muito grande. M√°ximo: 5MB', 'error');
          return;
        }

        const result = await window.dataSdk.create({
          type: 'photo', file_data: fileKey, photo_title: title, photo_responsible: responsible, photo_description: desc, created_at: new Date().toISOString(),
          client_id: document.getElementById('detail-client-name').textContent, file_name: file.name, title: '', content: '', client_name: '',
          piece_name: '', piece_type: '', caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', 
          regulagem: false, regulagem_by: '', regulagem_date: '', vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
          video_description: '', video_responsible: '', os_title: '', os_date: '', os_solicitante: '', os_description: '', os_video_file: '', os_video_name: '',
          os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
          os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
          os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
        });
        if (result.isOk) { hideUploadPhotoModal(); document.getElementById('photo-file-input').value = ''; document.getElementById('photo-title-input').value = ''; document.getElementById('photo-responsible-input').value = ''; document.getElementById('photo-description-input').value = ''; showToast('‚úÖ Foto enviada com sucesso!'); renderPhotos(); }
        else showToast('‚ùå Erro ao enviar foto.', 'error');
      };
      reader.readAsDataURL(file);
    }

    async function handleUploadVideo(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite de 999 registros atingido.', 'error'); return; }

      const file = document.getElementById('video-file-input').files[0];
      const videoName = document.getElementById('video-name-input').value.trim();
      const responsible = document.getElementById('video-responsible-input').value.trim();
      const desc = document.getElementById('video-description-input').value.trim();
      if (!file) { showToast('Selecione um v√≠deo', 'error'); return; }
      if (!videoName) { showToast('Digite um nome para o v√≠deo', 'error'); return; }
      if (!responsible) { showToast('Digite seu nome', 'error'); return; }
      if (!desc) { showToast('Descreva o v√≠deo', 'error'); return; }

      const fileKey = `video_${Date.now()}_${Math.random()}`;
      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          localStorage.setItem(fileKey, e.target.result);
        } catch (err) {
          showToast('Arquivo muito grande. M√°ximo: 5MB', 'error');
          return;
        }

        const result = await window.dataSdk.create({
          type: 'video', file_data: fileKey, file_name: file.name, video_name: videoName, video_responsible: responsible, video_description: desc, created_at: new Date().toISOString(),
          client_id: document.getElementById('detail-client-name').textContent, title: '', content: '', client_name: '',
          piece_name: '', piece_type: '', caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', 
          regulagem: false, regulagem_by: '', regulagem_date: '', vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
          photo_description: '', photo_title: '', photo_responsible: '', os_title: '', os_date: '', os_solicitante: '', os_description: '', os_video_file: '', os_video_name: '',
          os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
          os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
          os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
        });
        if (result.isOk) { 
          hideUploadVideoModal(); 
          document.getElementById('video-file-input').value = ''; 
          document.getElementById('video-name-input').value = ''; 
          document.getElementById('video-responsible-input').value = ''; 
          document.getElementById('video-description-input').value = ''; 
          showToast('‚úÖ V√≠deo enviado com sucesso!'); 
          renderVideos(); 
        }
        else showToast('‚ùå Erro ao enviar v√≠deo.', 'error');
      };
      reader.readAsDataURL(file);
    }

    async function handleAddOrder(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite atingido.', 'error'); return; }

      const videoFile = document.getElementById('os-initial-video-input').files[0];
      let initialVideoData = '';

      if (videoFile) {
        await new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            initialVideoData = e.target.result;
            resolve();
          };
          reader.readAsDataURL(videoFile);
        });
      }

      const result = await window.dataSdk.create({
        type: 'order', os_title: document.getElementById('os-title-input').value.trim(),
        os_date: document.getElementById('os-date-input').value, os_solicitante: document.getElementById('os-solicitante-input').value.trim(),
        os_description: document.getElementById('os-description-input').value.trim(), created_at: new Date().toISOString(),
        os_initial_video: initialVideoData, os_initial_video_name: videoFile ? videoFile.name : '', os_number: '', os_all_videos: '',
        client_id: document.getElementById('detail-client-name').textContent, title: '', content: '', client_name: '',
        piece_name: '', piece_type: '', caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', 
        regulagem: false, regulagem_by: '', regulagem_date: '', vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
        file_name: '', file_data: '', photo_description: '', video_description: '', os_video_file: '', os_video_name: '',
        os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
        os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
        os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
      });
      if (result.isOk) { hideAddOrderModal(); showToast('O.S. criada!'); renderOrders(); }
      else showToast('Erro ao criar.', 'error');
    }

    async function handleAddClient(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite atingido.', 'error'); return; }

      const name = document.getElementById('client-name-input').value.trim();
      const result = await window.dataSdk.create({
        type: 'client', client_name: name, created_at: new Date().toISOString(), title: '', content: '', piece_name: '', piece_type: '',
        caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', regulagem: false, regulagem_by: '', regulagem_date: '',
        vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
        client_id: '', file_name: '', file_data: '', photo_description: '', video_description: '', os_title: '', os_date: '', os_solicitante: '', os_description: '', os_video_file: '', os_video_name: '',
        os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
        os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
        os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
      });
      if (result.isOk) { 
        hideAddClientModal(); 
        document.getElementById('client-name-input').value = '';
        showToast('Cliente adicionado!');
        // Atualiza a tela com os novos dados
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
        renderClients(window.dataSdk.storage);
      }
      else showToast('Erro ao adicionar.', 'error');
    }

    async function handleAddNotice(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite atingido.', 'error'); return; }

      const result = await window.dataSdk.create({
        type: 'notice', title: document.getElementById('notice-title-input').value.trim(),
        content: document.getElementById('notice-content-input').value.trim(), created_at: new Date().toISOString(),
        client_name: '', piece_name: '', piece_type: '', caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '',
        regulagem: false, regulagem_by: '', regulagem_date: '', vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
        client_id: '', file_name: '', file_data: '', photo_description: '', video_description: '', os_title: '', os_date: '', os_solicitante: '', 
        os_description: '', os_video_file: '', os_video_name: '',
        os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
        os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
        os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
      });
      if (result.isOk) { 
        hideAddNoticeModal(); 
        document.getElementById('notice-title-input').value = '';
        document.getElementById('notice-content-input').value = '';
        showToast('Aviso adicionado!');
        // Atualiza a tela com os novos dados
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
        renderNotices(window.dataSdk.storage);
      }
      else showToast('Erro ao adicionar.', 'error');
    }

    async function handleAddPiece(event) {
      event.preventDefault();
      if (currentRecordCount >= 999) { showToast('Limite atingido.', 'error'); return; }

      const result = await window.dataSdk.create({
        type: 'piece', piece_name: document.getElementById('piece-name-input').value.trim(),
        piece_type: document.getElementById('piece-type-select').value, created_at: new Date().toISOString(),
        client_id: currentClientForChecklist, caixilho: false, caixilho_by: '', caixilho_date: '', vidro: false, vidro_by: '', vidro_date: '', 
        regulagem: false, regulagem_by: '', regulagem_date: '', vedacao: false, vedacao_by: '', vedacao_date: '', arremate: false, arremate_by: '', arremate_date: '',
        title: '', content: '', client_name: '', file_name: '', file_data: '', photo_description: '', video_description: '',
        os_title: '', os_date: '', os_solicitante: '', os_description: '', os_video_file: '', os_video_name: '',
        os_archived: false, os_archived_by: '', os_archived_date: '', os_produced: false, os_produced_by: '', os_produced_date: '',
        os_material_separated: false, os_material_by: '', os_material_date: '', os_completed: false, os_completed_by: '', os_completed_date: '',
        os_finalized: false, os_finalized_by: '', os_finalized_date: '', os_finalized_video: '', os_finalized_video_name: ''
      });
      if (result.isOk) { 
        hideAddPieceModal(); 
        document.getElementById('piece-name-input').value = '';
        document.getElementById('piece-type-select').value = '';
        showToast('Pe√ßa adicionada!');
        // Atualiza a tela com os novos dados
        allData = window.dataSdk.storage;
        currentRecordCount = allData.length;
      }
      else showToast('Erro ao adicionar.', 'error');
    }

    const dataHandler = {
      onDataChanged(data) { allData = data; currentRecordCount = data.length; renderClients(data); renderNotices(data); }
    };

    async function onConfigChange(newConfig) {
      config = { ...defaultConfig, ...newConfig };
      const t = document.getElementById('company-title');
      const s = document.getElementById('welcome-subtitle');
      if (t) t.textContent = config.company_name;
      if (s) s.textContent = config.welcome_text;
    }

    function mapToCapabilities(config) { return { recolorables: [], borderables: [], fontEditable: undefined, fontSizeable: undefined }; }
    function mapToEditPanelValues(config) { return new Map([['company_name', config.company_name], ['welcome_text', config.welcome_text]]); }

    async function init() {
      console.log('üîß Iniciando aplica√ß√£o...');
      console.log('üì¶ localStorage jmar_data:', localStorage.getItem('jmar_data'));
      
      if (window.elementSdk) window.elementSdk.init({ defaultConfig, onConfigChange, mapToCapabilities, mapToEditPanelValues });
      if (window.dataSdk) {
        console.log('üìö dataSdk encontrado, iniciando...');
        const result = await window.dataSdk.init(dataHandler);
        console.log('‚úÖ dataSdk init resultado:', result);
        console.log('üìä Dados carregados:', window.dataSdk.storage);
        if (!result.isOk) showToast('Erro ao conectar.', 'error');
      } else {
        console.error('‚ùå dataSdk n√£o encontrado!');
      }
    }
    
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cbd3d580328caef',t:'MTc3MDc0MzYzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>